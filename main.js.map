{"version":3,"file":"main.js","mappings":"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","sources":["webpack://webpack-demo-ts/./src/colorreductionmanagement.ts","webpack://webpack-demo-ts/./src/common.ts","webpack://webpack-demo-ts/./src/facetBorderSegmenter.ts","webpack://webpack-demo-ts/./src/facetBorderTracer.ts","webpack://webpack-demo-ts/./src/facetCreator.ts","webpack://webpack-demo-ts/./src/facetLabelPlacer.ts","webpack://webpack-demo-ts/./src/facetReducer.ts","webpack://webpack-demo-ts/./src/facetmanagement.ts","webpack://webpack-demo-ts/./src/gui.ts","webpack://webpack-demo-ts/./src/guiprocessmanager.ts","webpack://webpack-demo-ts/./src/lib/clipboard.ts","webpack://webpack-demo-ts/./src/lib/clustering.ts","webpack://webpack-demo-ts/./src/lib/colorconversion.ts","webpack://webpack-demo-ts/./src/lib/datastructs.ts","webpack://webpack-demo-ts/./src/lib/fill.ts","webpack://webpack-demo-ts/./src/lib/polylabel.ts","webpack://webpack-demo-ts/./src/main.ts","webpack://webpack-demo-ts/./src/random.ts","webpack://webpack-demo-ts/./src/settings.ts","webpack://webpack-demo-ts/./src/structs/boundingbox.ts","webpack://webpack-demo-ts/./src/structs/point.ts","webpack://webpack-demo-ts/./src/structs/typedarrays.ts","webpack://webpack-demo-ts/webpack/bootstrap","webpack://webpack-demo-ts/webpack/startup"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./common\", \"./lib/clustering\", \"./lib/colorconversion\", \"./settings\", \"./structs/typedarrays\", \"./random\"], function (require, exports, common_1, clustering_1, colorconversion_1, settings_1, typedarrays_1, random_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.ColorReducer = exports.ColorMapResult = void 0;\r\n    var ColorMapResult = /** @class */ (function () {\r\n        function ColorMapResult() {\r\n        }\r\n        return ColorMapResult;\r\n    }());\r\n    exports.ColorMapResult = ColorMapResult;\r\n    var ColorReducer = /** @class */ (function () {\r\n        function ColorReducer() {\r\n        }\r\n        /**\r\n         *  Creates a map of the various colors used\r\n         */\r\n        ColorReducer.createColorMap = function (kmeansImgData) {\r\n            var imgColorIndices = new typedarrays_1.Uint8Array2D(kmeansImgData.width, kmeansImgData.height);\r\n            var colorIndex = 0;\r\n            var colors = {};\r\n            var colorsByIndex = [];\r\n            var idx = 0;\r\n            for (var j = 0; j < kmeansImgData.height; j++) {\r\n                for (var i = 0; i < kmeansImgData.width; i++) {\r\n                    var r = kmeansImgData.data[idx++];\r\n                    var g = kmeansImgData.data[idx++];\r\n                    var b = kmeansImgData.data[idx++];\r\n                    var a = kmeansImgData.data[idx++];\r\n                    var currentColorIndex = void 0;\r\n                    var color = r + \",\" + g + \",\" + b;\r\n                    if (typeof colors[color] === \"undefined\") {\r\n                        currentColorIndex = colorIndex;\r\n                        colors[color] = colorIndex;\r\n                        colorsByIndex.push([r, g, b]);\r\n                        colorIndex++;\r\n                    }\r\n                    else {\r\n                        currentColorIndex = colors[color];\r\n                    }\r\n                    imgColorIndices.set(i, j, currentColorIndex);\r\n                }\r\n            }\r\n            var result = new ColorMapResult();\r\n            result.imgColorIndices = imgColorIndices;\r\n            result.colorsByIndex = colorsByIndex;\r\n            result.width = kmeansImgData.width;\r\n            result.height = kmeansImgData.height;\r\n            return result;\r\n        };\r\n        /**\r\n         *  Applies K-means clustering on the imgData to reduce the colors to\r\n         *  k clusters and then output the result to the given outputImgData\r\n         */\r\n        ColorReducer.applyKMeansClustering = function (imgData, outputImgData, ctx, settings, onUpdate) {\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var vectors, idx, vIdx, bitsToChopOff, pointsByColor, j, i, r, g, b, a, color, _i, _a, color, rgb, data, weight, vec, random, kmeans, curTime;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            vectors = [];\r\n                            idx = 0;\r\n                            vIdx = 0;\r\n                            bitsToChopOff = 2;\r\n                            pointsByColor = {};\r\n                            for (j = 0; j < imgData.height; j++) {\r\n                                for (i = 0; i < imgData.width; i++) {\r\n                                    r = imgData.data[idx++];\r\n                                    g = imgData.data[idx++];\r\n                                    b = imgData.data[idx++];\r\n                                    a = imgData.data[idx++];\r\n                                    // small performance boost: reduce bitness of colors by chopping off the last bits\r\n                                    // this will group more colors with only slight variation in color together, reducing the size of the points\r\n                                    r = r >> bitsToChopOff << bitsToChopOff;\r\n                                    g = g >> bitsToChopOff << bitsToChopOff;\r\n                                    b = b >> bitsToChopOff << bitsToChopOff;\r\n                                    color = \"\".concat(r, \",\").concat(g, \",\").concat(b);\r\n                                    if (!(color in pointsByColor)) {\r\n                                        pointsByColor[color] = [j * imgData.width + i];\r\n                                    }\r\n                                    else {\r\n                                        pointsByColor[color].push(j * imgData.width + i);\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (_i = 0, _a = Object.keys(pointsByColor); _i < _a.length; _i++) {\r\n                                color = _a[_i];\r\n                                rgb = color.split(\",\").map(function (v) { return parseInt(v); });\r\n                                data = void 0;\r\n                                if (settings.kMeansClusteringColorSpace === settings_1.ClusteringColorSpace.RGB) {\r\n                                    data = rgb;\r\n                                }\r\n                                else if (settings.kMeansClusteringColorSpace === settings_1.ClusteringColorSpace.HSL) {\r\n                                    data = (0, colorconversion_1.rgbToHsl)(rgb[0], rgb[1], rgb[2]);\r\n                                }\r\n                                else if (settings.kMeansClusteringColorSpace === settings_1.ClusteringColorSpace.LAB) {\r\n                                    data = (0, colorconversion_1.rgb2lab)(rgb);\r\n                                }\r\n                                else {\r\n                                    data = rgb;\r\n                                }\r\n                                weight = pointsByColor[color].length / (imgData.width * imgData.height);\r\n                                vec = new clustering_1.Vector(data, weight);\r\n                                vec.tag = rgb;\r\n                                vectors[vIdx++] = vec;\r\n                            }\r\n                            random = new random_1.Random(settings.randomSeed === 0 ? new Date().getTime() : settings.randomSeed);\r\n                            kmeans = new clustering_1.KMeans(vectors, settings.kMeansNrOfClusters, random);\r\n                            curTime = new Date().getTime();\r\n                            kmeans.step();\r\n                            _b.label = 1;\r\n                        case 1:\r\n                            if (!(kmeans.currentDeltaDistanceDifference > settings.kMeansMinDeltaDifference)) return [3 /*break*/, 4];\r\n                            kmeans.step();\r\n                            if (!(new Date().getTime() - curTime > 500)) return [3 /*break*/, 3];\r\n                            curTime = new Date().getTime();\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 2:\r\n                            _b.sent();\r\n                            if (onUpdate != null) {\r\n                                ColorReducer.updateKmeansOutputImageData(kmeans, settings, pointsByColor, imgData, outputImgData, false);\r\n                                onUpdate(kmeans);\r\n                            }\r\n                            _b.label = 3;\r\n                        case 3: return [3 /*break*/, 1];\r\n                        case 4:\r\n                            // update the output image data (because it will be used for further processing)\r\n                            ColorReducer.updateKmeansOutputImageData(kmeans, settings, pointsByColor, imgData, outputImgData, true);\r\n                            if (onUpdate != null) {\r\n                                onUpdate(kmeans);\r\n                            }\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        /**\r\n         *  Updates the image data from the current kmeans centroids and their respective associated colors (vectors)\r\n         */\r\n        ColorReducer.updateKmeansOutputImageData = function (kmeans, settings, pointsByColor, imgData, outputImgData, restrictToSpecifiedColors) {\r\n            for (var c = 0; c < kmeans.centroids.length; c++) {\r\n                // for each cluster centroid\r\n                var centroid = kmeans.centroids[c];\r\n                // points per category are the different unique colors belonging to that cluster\r\n                for (var _i = 0, _a = kmeans.pointsPerCategory[c]; _i < _a.length; _i++) {\r\n                    var v = _a[_i];\r\n                    // determine the rgb color value of the cluster centroid\r\n                    var rgb = void 0;\r\n                    if (settings.kMeansClusteringColorSpace === settings_1.ClusteringColorSpace.RGB) {\r\n                        rgb = centroid.values;\r\n                    }\r\n                    else if (settings.kMeansClusteringColorSpace === settings_1.ClusteringColorSpace.HSL) {\r\n                        var hsl = centroid.values;\r\n                        rgb = (0, colorconversion_1.hslToRgb)(hsl[0], hsl[1], hsl[2]);\r\n                    }\r\n                    else if (settings.kMeansClusteringColorSpace === settings_1.ClusteringColorSpace.LAB) {\r\n                        var lab = centroid.values;\r\n                        rgb = (0, colorconversion_1.lab2rgb)(lab);\r\n                    }\r\n                    else {\r\n                        rgb = centroid.values;\r\n                    }\r\n                    // remove decimals\r\n                    rgb = rgb.map(function (v) { return Math.floor(v); });\r\n                    if (restrictToSpecifiedColors) {\r\n                        if (settings.kMeansColorRestrictions.length > 0) {\r\n                            // there are color restrictions, for each centroid find the color from the color restrictions that's the closest\r\n                            var minDistance = Number.MAX_VALUE;\r\n                            var closestRestrictedColor = null;\r\n                            for (var _b = 0, _c = settings.kMeansColorRestrictions; _b < _c.length; _b++) {\r\n                                var color = _c[_b];\r\n                                // RGB distance is not very good for the human eye perception, convert both to lab and then calculate the distance\r\n                                var centroidLab = (0, colorconversion_1.rgb2lab)(rgb);\r\n                                var restrictionLab = void 0;\r\n                                if (typeof color === \"string\") {\r\n                                    restrictionLab = (0, colorconversion_1.rgb2lab)(settings.colorAliases[color]);\r\n                                }\r\n                                else {\r\n                                    restrictionLab = (0, colorconversion_1.rgb2lab)(color);\r\n                                }\r\n                                var distance = Math.sqrt((centroidLab[0] - restrictionLab[0]) * (centroidLab[0] - restrictionLab[0]) +\r\n                                    (centroidLab[1] - restrictionLab[1]) * (centroidLab[1] - restrictionLab[1]) +\r\n                                    (centroidLab[2] - restrictionLab[2]) * (centroidLab[2] - restrictionLab[2]));\r\n                                if (distance < minDistance) {\r\n                                    minDistance = distance;\r\n                                    closestRestrictedColor = color;\r\n                                }\r\n                            }\r\n                            // use this color instead\r\n                            if (closestRestrictedColor !== null) {\r\n                                if (typeof closestRestrictedColor === \"string\") {\r\n                                    rgb = settings.colorAliases[closestRestrictedColor];\r\n                                }\r\n                                else {\r\n                                    rgb = closestRestrictedColor;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    var pointRGB = v.tag;\r\n                    // replace all pixels of the old color by the new centroid color\r\n                    var pointColor = \"\".concat(Math.floor(pointRGB[0]), \",\").concat(Math.floor(pointRGB[1]), \",\").concat(Math.floor(pointRGB[2]));\r\n                    for (var _d = 0, _e = pointsByColor[pointColor]; _d < _e.length; _d++) {\r\n                        var pt = _e[_d];\r\n                        var ptx = pt % imgData.width;\r\n                        var pty = Math.floor(pt / imgData.width);\r\n                        var dataOffset = (pty * imgData.width + ptx) * 4;\r\n                        outputImgData.data[dataOffset++] = rgb[0];\r\n                        outputImgData.data[dataOffset++] = rgb[1];\r\n                        outputImgData.data[dataOffset++] = rgb[2];\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         *  Builds a distance matrix for each color to each other\r\n         */\r\n        ColorReducer.buildColorDistanceMatrix = function (colorsByIndex) {\r\n            var colorDistances = new Array(colorsByIndex.length);\r\n            for (var j = 0; j < colorsByIndex.length; j++) {\r\n                colorDistances[j] = new Array(colorDistances.length);\r\n            }\r\n            for (var j = 0; j < colorsByIndex.length; j++) {\r\n                for (var i = j; i < colorsByIndex.length; i++) {\r\n                    var c1 = colorsByIndex[j];\r\n                    var c2 = colorsByIndex[i];\r\n                    var distance = Math.sqrt((c1[0] - c2[0]) * (c1[0] - c2[0]) +\r\n                        (c1[1] - c2[1]) * (c1[1] - c2[1]) +\r\n                        (c1[2] - c2[2]) * (c1[2] - c2[2]));\r\n                    colorDistances[i][j] = distance;\r\n                    colorDistances[j][i] = distance;\r\n                }\r\n            }\r\n            return colorDistances;\r\n        };\r\n        ColorReducer.processNarrowPixelStripCleanup = function (colormapResult) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var colorDistances, count, imgColorIndices, j, i, top_1, bottom, left, right, cur, topColorDistance, bottomColorDistance, leftColorDistance, rightColorDistance;\r\n                return __generator(this, function (_a) {\r\n                    colorDistances = ColorReducer.buildColorDistanceMatrix(colormapResult.colorsByIndex);\r\n                    count = 0;\r\n                    imgColorIndices = colormapResult.imgColorIndices;\r\n                    for (j = 1; j < colormapResult.height - 1; j++) {\r\n                        for (i = 1; i < colormapResult.width - 1; i++) {\r\n                            top_1 = imgColorIndices.get(i, j - 1);\r\n                            bottom = imgColorIndices.get(i, j + 1);\r\n                            left = imgColorIndices.get(i - 1, j);\r\n                            right = imgColorIndices.get(i + 1, j);\r\n                            cur = imgColorIndices.get(i, j);\r\n                            if (cur !== top_1 && cur !== bottom && cur !== left && cur !== right) {\r\n                                // single pixel\r\n                            }\r\n                            else if (cur !== top_1 && cur !== bottom) {\r\n                                topColorDistance = colorDistances[cur][top_1];\r\n                                bottomColorDistance = colorDistances[cur][bottom];\r\n                                imgColorIndices.set(i, j, topColorDistance < bottomColorDistance ? top_1 : bottom);\r\n                                count++;\r\n                            }\r\n                            else if (cur !== left && cur !== right) {\r\n                                leftColorDistance = colorDistances[cur][left];\r\n                                rightColorDistance = colorDistances[cur][right];\r\n                                imgColorIndices.set(i, j, leftColorDistance < rightColorDistance ? left : right);\r\n                                count++;\r\n                            }\r\n                        }\r\n                    }\r\n                    console.log(count + \" pixels replaced to remove narrow pixel strips\");\r\n                    return [2 /*return*/];\r\n                });\r\n            });\r\n        };\r\n        return ColorReducer;\r\n    }());\r\n    exports.ColorReducer = ColorReducer;\r\n});\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.CancellationToken = exports.delay = void 0;\r\n    function delay(ms) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof window !== \"undefined\") {\r\n                    return [2 /*return*/, new Promise(function (exec) { return window.setTimeout(exec, ms); })];\r\n                }\r\n                else {\r\n                    return [2 /*return*/, new Promise(function (exec) { return exec(); })];\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    }\r\n    exports.delay = delay;\r\n    var CancellationToken = /** @class */ (function () {\r\n        function CancellationToken() {\r\n            this.isCancelled = false;\r\n        }\r\n        return CancellationToken;\r\n    }());\r\n    exports.CancellationToken = CancellationToken;\r\n});\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./common\", \"./structs/point\", \"./facetmanagement\"], function (require, exports, common_1, point_1, facetmanagement_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.FacetBorderSegmenter = exports.FacetBoundarySegment = exports.PathSegment = void 0;\r\n    /**\r\n     *  Path segment is a segment of a border path that is adjacent to a specific neighbour facet\r\n     */\r\n    var PathSegment = /** @class */ (function () {\r\n        function PathSegment(points, neighbour) {\r\n            this.points = points;\r\n            this.neighbour = neighbour;\r\n        }\r\n        return PathSegment;\r\n    }());\r\n    exports.PathSegment = PathSegment;\r\n    /**\r\n     * Facet boundary segment describes the matched segment that is shared between 2 facets\r\n     * When 2 segments are matched, one will be the original segment and the other one is removed\r\n     * This ensures that all facets share the same segments, but sometimes in reverse order to ensure\r\n     * the correct continuity of its entire oborder path\r\n     */\r\n    var FacetBoundarySegment = /** @class */ (function () {\r\n        function FacetBoundarySegment(originalSegment, neighbour, reverseOrder) {\r\n            this.originalSegment = originalSegment;\r\n            this.neighbour = neighbour;\r\n            this.reverseOrder = reverseOrder;\r\n        }\r\n        return FacetBoundarySegment;\r\n    }());\r\n    exports.FacetBoundarySegment = FacetBoundarySegment;\r\n    var FacetBorderSegmenter = /** @class */ (function () {\r\n        function FacetBorderSegmenter() {\r\n        }\r\n        /**\r\n         *  Builds border segments that are shared between facets\r\n         *  While border paths are all nice and fancy, they are not linked to neighbour facets\r\n         *  So any change in the paths makes a not so nice gap between the facets, which makes smoothing them out impossible\r\n         */\r\n        FacetBorderSegmenter.buildFacetBorderSegments = function (facetResult, nrOfTimesToHalvePoints, onUpdate) {\r\n            if (nrOfTimesToHalvePoints === void 0) { nrOfTimesToHalvePoints = 2; }\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var segmentsPerFacet;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            segmentsPerFacet = FacetBorderSegmenter.prepareSegmentsPerFacet(facetResult);\r\n                            // now reduce the segment complexity with Haar wavelet reduction to smooth them out and make them\r\n                            // more curvy with data points instead of zig zag of a grid\r\n                            FacetBorderSegmenter.reduceSegmentComplexity(facetResult, segmentsPerFacet, nrOfTimesToHalvePoints);\r\n                            // now see which segments of facets with the prepared segments of the neighbour facets\r\n                            // and point them to the same one\r\n                            return [4 /*yield*/, FacetBorderSegmenter.matchSegmentsWithNeighbours(facetResult, segmentsPerFacet, onUpdate)];\r\n                        case 1:\r\n                            // now see which segments of facets with the prepared segments of the neighbour facets\r\n                            // and point them to the same one\r\n                            _a.sent();\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        /**\r\n         *  Chops up the border paths per facet into segments adjacent tothe same neighbour\r\n         */\r\n        FacetBorderSegmenter.prepareSegmentsPerFacet = function (facetResult) {\r\n            var segmentsPerFacet = new Array(facetResult.facets.length);\r\n            for (var _i = 0, _a = facetResult.facets; _i < _a.length; _i++) {\r\n                var f = _a[_i];\r\n                if (f != null) {\r\n                    var segments = [];\r\n                    if (f.borderPath.length > 1) {\r\n                        var currentPoints = [];\r\n                        currentPoints.push(f.borderPath[0]);\r\n                        for (var i = 1; i < f.borderPath.length; i++) {\r\n                            var prevBorderPoint = f.borderPath[i - 1];\r\n                            var curBorderPoint = f.borderPath[i];\r\n                            var oldNeighbour = prevBorderPoint.getNeighbour(facetResult);\r\n                            var curNeighbour = curBorderPoint.getNeighbour(facetResult);\r\n                            var isTransitionPoint = false;\r\n                            if (oldNeighbour !== curNeighbour) {\r\n                                isTransitionPoint = true;\r\n                            }\r\n                            else {\r\n                                // it's possible that due to inner facets inside the current facet that the\r\n                                // border is interrupted on that facet's side, but not on the neighbour's side\r\n                                if (oldNeighbour !== -1) {\r\n                                    // check for tight rotations to break path if diagonals contain a different neighbour,\r\n                                    // see https://i.imgur.com/o6Srqwj.png for visual path of the issue\r\n                                    if (prevBorderPoint.x === curBorderPoint.x &&\r\n                                        prevBorderPoint.y === curBorderPoint.y) {\r\n                                        // rotation turn\r\n                                        // check the diagonal neighbour to see if it remains the same\r\n                                        //   +---+---+\r\n                                        //   | dN|   |\r\n                                        //   +---xxxx> (x = wall, dN = diagNeighbour)\r\n                                        //   |   x f |\r\n                                        //   +---v---+\r\n                                        if ((prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Top && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Left) ||\r\n                                            (prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Left && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Top)) {\r\n                                            var diagNeighbour = facetResult.facetMap.get(curBorderPoint.x - 1, curBorderPoint.y - 1);\r\n                                            if (diagNeighbour !== oldNeighbour) {\r\n                                                isTransitionPoint = true;\r\n                                            }\r\n                                        }\r\n                                        else if ((prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Top && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Right) ||\r\n                                            (prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Right && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Top)) {\r\n                                            var diagNeighbour = facetResult.facetMap.get(curBorderPoint.x + 1, curBorderPoint.y - 1);\r\n                                            if (diagNeighbour !== oldNeighbour) {\r\n                                                isTransitionPoint = true;\r\n                                            }\r\n                                        }\r\n                                        else if ((prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Bottom && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Left) ||\r\n                                            (prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Left && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Bottom)) {\r\n                                            var diagNeighbour = facetResult.facetMap.get(curBorderPoint.x - 1, curBorderPoint.y + 1);\r\n                                            if (diagNeighbour !== oldNeighbour) {\r\n                                                isTransitionPoint = true;\r\n                                            }\r\n                                        }\r\n                                        else if ((prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Bottom && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Right) ||\r\n                                            (prevBorderPoint.orientation === facetmanagement_1.OrientationEnum.Right && curBorderPoint.orientation === facetmanagement_1.OrientationEnum.Bottom)) {\r\n                                            var diagNeighbour = facetResult.facetMap.get(curBorderPoint.x + 1, curBorderPoint.y + 1);\r\n                                            if (diagNeighbour !== oldNeighbour) {\r\n                                                isTransitionPoint = true;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            currentPoints.push(curBorderPoint);\r\n                            if (isTransitionPoint) {\r\n                                // aha! a transition point, create the current points as new segment\r\n                                // and start a new list\r\n                                if (currentPoints.length > 1) {\r\n                                    var segment = new PathSegment(currentPoints, oldNeighbour);\r\n                                    segments.push(segment);\r\n                                    currentPoints = [curBorderPoint];\r\n                                }\r\n                            }\r\n                        }\r\n                        // finally check if there is a remainder partial segment and either prepend\r\n                        // the points to the first segment if they have the same neighbour or construct a\r\n                        // new segment\r\n                        if (currentPoints.length > 1) {\r\n                            var oldNeighbour = f.borderPath[f.borderPath.length - 1].getNeighbour(facetResult);\r\n                            if (segments.length > 0 && segments[0].neighbour === oldNeighbour) {\r\n                                // the first segment and the remainder of the last one are the same part\r\n                                // add the current points to the first segment by prefixing it\r\n                                var mergedPoints = currentPoints.concat(segments[0].points);\r\n                                segments[0].points = mergedPoints;\r\n                            }\r\n                            else {\r\n                                // add the remainder as final segment\r\n                                var segment = new PathSegment(currentPoints, oldNeighbour);\r\n                                segments.push(segment);\r\n                                currentPoints = [];\r\n                            }\r\n                        }\r\n                    }\r\n                    segmentsPerFacet[f.id] = segments;\r\n                }\r\n            }\r\n            return segmentsPerFacet;\r\n        };\r\n        /**\r\n         * Reduces each segment border path points\r\n         */\r\n        FacetBorderSegmenter.reduceSegmentComplexity = function (facetResult, segmentsPerFacet, nrOfTimesToHalvePoints) {\r\n            for (var _i = 0, _a = facetResult.facets; _i < _a.length; _i++) {\r\n                var f = _a[_i];\r\n                if (f != null) {\r\n                    for (var _b = 0, _c = segmentsPerFacet[f.id]; _b < _c.length; _b++) {\r\n                        var segment = _c[_b];\r\n                        for (var i = 0; i < nrOfTimesToHalvePoints; i++) {\r\n                            segment.points = FacetBorderSegmenter.reduceSegmentHaarWavelet(segment.points, true, facetResult.width, facetResult.height);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         *  Remove the points by taking the average per pair and using that as a new point\r\n         *  in the reduced segment. The delta values that create the Haar wavelet are not tracked\r\n         *  because they are unneeded.\r\n         */\r\n        FacetBorderSegmenter.reduceSegmentHaarWavelet = function (newpath, skipOutsideBorders, width, height) {\r\n            if (newpath.length <= 5) {\r\n                return newpath;\r\n            }\r\n            var reducedPath = [];\r\n            reducedPath.push(newpath[0]);\r\n            for (var i = 1; i < newpath.length - 2; i += 2) {\r\n                if (!skipOutsideBorders || (skipOutsideBorders && !FacetBorderSegmenter.isOutsideBorderPoint(newpath[i], width, height))) {\r\n                    var cx = (newpath[i].x + newpath[i + 1].x) / 2;\r\n                    var cy = (newpath[i].y + newpath[i + 1].y) / 2;\r\n                    reducedPath.push(new facetmanagement_1.PathPoint(new point_1.Point(cx, cy), facetmanagement_1.OrientationEnum.Left));\r\n                }\r\n                else {\r\n                    reducedPath.push(newpath[i]);\r\n                    reducedPath.push(newpath[i + 1]);\r\n                }\r\n            }\r\n            // close the loop\r\n            reducedPath.push(newpath[newpath.length - 1]);\r\n            return reducedPath;\r\n        };\r\n        FacetBorderSegmenter.isOutsideBorderPoint = function (point, width, height) {\r\n            return point.x === 0 || point.y === 0 || point.x === width - 1 || point.y === height - 1;\r\n        };\r\n        FacetBorderSegmenter.calculateArea = function (path) {\r\n            var total = 0;\r\n            for (var i = 0; i < path.length; i++) {\r\n                var addX = path[i].x;\r\n                var addY = path[i === path.length - 1 ? 0 : i + 1].y;\r\n                var subX = path[i === path.length - 1 ? 0 : i + 1].x;\r\n                var subY = path[i].y;\r\n                total += (addX * addY * 0.5);\r\n                total -= (subX * subY * 0.5);\r\n            }\r\n            return Math.abs(total);\r\n        };\r\n        /**\r\n         *  Matches all segments with each other between facets and their neighbour\r\n         *  A segment matches when the start and end match or the start matches with the end and vice versa\r\n         *  (then the segment will need to be traversed in reverse order)\r\n         */\r\n        FacetBorderSegmenter.matchSegmentsWithNeighbours = function (facetResult, segmentsPerFacet, onUpdate) {\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var MAX_DISTANCE, _i, _a, f, count, _b, _c, f, debug, s, segment, neighbourFacet, matchFound, neighbourSegments, ns, neighbourSegment, segStartPoint, segEndPoint, nSegStartPoint, nSegEndPoint, matchesStraight, matchesReverse;\r\n                return __generator(this, function (_d) {\r\n                    switch (_d.label) {\r\n                        case 0:\r\n                            MAX_DISTANCE = 4;\r\n                            // reserve room\r\n                            for (_i = 0, _a = facetResult.facets; _i < _a.length; _i++) {\r\n                                f = _a[_i];\r\n                                if (f != null) {\r\n                                    f.borderSegments = new Array(segmentsPerFacet[f.id].length);\r\n                                }\r\n                            }\r\n                            count = 0;\r\n                            _b = 0, _c = facetResult.facets;\r\n                            _d.label = 1;\r\n                        case 1:\r\n                            if (!(_b < _c.length)) return [3 /*break*/, 5];\r\n                            f = _c[_b];\r\n                            if (!(f != null)) return [3 /*break*/, 3];\r\n                            debug = false;\r\n                            for (s = 0; s < segmentsPerFacet[f.id].length; s++) {\r\n                                segment = segmentsPerFacet[f.id][s];\r\n                                if (segment != null && f.borderSegments[s] == null) {\r\n                                    f.borderSegments[s] = new FacetBoundarySegment(segment, segment.neighbour, false);\r\n                                    if (debug) {\r\n                                        console.log(\"Setting facet \" + f.id + \" segment \" + s + \" to \" + f.borderSegments[s]);\r\n                                    }\r\n                                    if (segment.neighbour !== -1) {\r\n                                        neighbourFacet = facetResult.facets[segment.neighbour];\r\n                                        matchFound = false;\r\n                                        if (neighbourFacet != null) {\r\n                                            neighbourSegments = segmentsPerFacet[segment.neighbour];\r\n                                            for (ns = 0; ns < neighbourSegments.length; ns++) {\r\n                                                neighbourSegment = neighbourSegments[ns];\r\n                                                // only try to match against the segments that aren't processed yet\r\n                                                // and which are adjacent to the boundary of the current facet\r\n                                                if (neighbourSegment != null && neighbourSegment.neighbour === f.id) {\r\n                                                    segStartPoint = segment.points[0];\r\n                                                    segEndPoint = segment.points[segment.points.length - 1];\r\n                                                    nSegStartPoint = neighbourSegment.points[0];\r\n                                                    nSegEndPoint = neighbourSegment.points[neighbourSegment.points.length - 1];\r\n                                                    matchesStraight = (segStartPoint.distanceTo(nSegStartPoint) <= MAX_DISTANCE &&\r\n                                                        segEndPoint.distanceTo(nSegEndPoint) <= MAX_DISTANCE);\r\n                                                    matchesReverse = (segStartPoint.distanceTo(nSegEndPoint) <= MAX_DISTANCE &&\r\n                                                        segEndPoint.distanceTo(nSegStartPoint) <= MAX_DISTANCE);\r\n                                                    if (matchesStraight && matchesReverse) {\r\n                                                        // dang it , both match, it must be a tiny segment, but when placed wrongly it'll overlap in the path creating an hourglass \r\n                                                        //  e.g. https://i.imgur.com/XZQhxRV.png\r\n                                                        // determine which is the closest\r\n                                                        if (segStartPoint.distanceTo(nSegStartPoint) + segEndPoint.distanceTo(nSegEndPoint) <\r\n                                                            segStartPoint.distanceTo(nSegEndPoint) + segEndPoint.distanceTo(nSegStartPoint)) {\r\n                                                            matchesStraight = true;\r\n                                                            matchesReverse = false;\r\n                                                        }\r\n                                                        else {\r\n                                                            matchesStraight = false;\r\n                                                            matchesReverse = true;\r\n                                                        }\r\n                                                    }\r\n                                                    if (matchesStraight) {\r\n                                                        // start & end points match\r\n                                                        if (debug) {\r\n                                                            console.log(\"Match found for facet \" + f.id + \" to neighbour \" + neighbourFacet.id);\r\n                                                        }\r\n                                                        neighbourFacet.borderSegments[ns] = new FacetBoundarySegment(segment, f.id, false);\r\n                                                        if (debug) {\r\n                                                            console.log(\"Setting facet \" + neighbourFacet.id + \" segment \" + ns + \" to \" + neighbourFacet.borderSegments[ns]);\r\n                                                        }\r\n                                                        segmentsPerFacet[neighbourFacet.id][ns] = null;\r\n                                                        matchFound = true;\r\n                                                        break;\r\n                                                    }\r\n                                                    else if (matchesReverse) {\r\n                                                        // start & end points match  but in reverse order\r\n                                                        if (debug) {\r\n                                                            console.log(\"Reverse match found for facet \" + f.id + \" to neighbour \" + neighbourFacet.id);\r\n                                                        }\r\n                                                        neighbourFacet.borderSegments[ns] = new FacetBoundarySegment(segment, f.id, true);\r\n                                                        if (debug) {\r\n                                                            console.log(\"Setting facet \" + neighbourFacet.id + \" segment \" + ns + \" to \" + neighbourFacet.borderSegments[ns]);\r\n                                                        }\r\n                                                        segmentsPerFacet[neighbourFacet.id][ns] = null;\r\n                                                        matchFound = true;\r\n                                                        break;\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                        if (!matchFound && debug) {\r\n                                            // it's possible that the border is not shared with its neighbour\r\n                                            // this can happen when the segment fully falls inside the other facet\r\n                                            // though the above checks in the preparation of the segments should probably\r\n                                            // cover all cases\r\n                                            console.error(\"No match found for segment of \" + f.id + \": \" +\r\n                                                (\"siding \" + segment.neighbour + \" \" + segment.points[0] + \" -> \" + segment.points[segment.points.length - 1]));\r\n                                        }\r\n                                    }\r\n                                }\r\n                                // clear the current segment so it can't be processed again when processing the neighbour facet\r\n                                segmentsPerFacet[f.id][s] = null;\r\n                            }\r\n                            if (!(count % 100 === 0)) return [3 /*break*/, 3];\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 2:\r\n                            _d.sent();\r\n                            if (onUpdate != null) {\r\n                                onUpdate(f.id / facetResult.facets.length);\r\n                            }\r\n                            _d.label = 3;\r\n                        case 3:\r\n                            count++;\r\n                            _d.label = 4;\r\n                        case 4:\r\n                            _b++;\r\n                            return [3 /*break*/, 1];\r\n                        case 5:\r\n                            if (onUpdate != null) {\r\n                                onUpdate(1);\r\n                            }\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        return FacetBorderSegmenter;\r\n    }());\r\n    exports.FacetBorderSegmenter = FacetBorderSegmenter;\r\n});\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./common\", \"./structs/point\", \"./structs/typedarrays\", \"./facetmanagement\"], function (require, exports, common_1, point_1, typedarrays_1, facetmanagement_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.FacetBorderTracer = void 0;\r\n    var FacetBorderTracer = /** @class */ (function () {\r\n        function FacetBorderTracer() {\r\n        }\r\n        /**\r\n         *  Traces the border path of the facet from the facet border points.\r\n         *  Imagine placing walls around the outer side of the border points.\r\n         */\r\n        FacetBorderTracer.buildFacetBorderPaths = function (facetResult, onUpdate) {\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var count, borderMask, facetProcessingOrder, fidx, f, _i, _a, bp, xWall, yWall, borderStartIndex, i, pt, path;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            count = 0;\r\n                            borderMask = new typedarrays_1.BooleanArray2D(facetResult.width, facetResult.height);\r\n                            facetProcessingOrder = facetResult.facets.filter(function (f) { return f != null; }).slice(0).sort(function (a, b) { return b.pointCount > a.pointCount ? 1 : (b.pointCount < a.pointCount ? -1 : 0); }).map(function (f) { return f.id; });\r\n                            fidx = 0;\r\n                            _b.label = 1;\r\n                        case 1:\r\n                            if (!(fidx < facetProcessingOrder.length)) return [3 /*break*/, 5];\r\n                            f = facetResult.facets[facetProcessingOrder[fidx]];\r\n                            if (!(f != null)) return [3 /*break*/, 3];\r\n                            for (_i = 0, _a = f.borderPoints; _i < _a.length; _i++) {\r\n                                bp = _a[_i];\r\n                                borderMask.set(bp.x, bp.y, true);\r\n                            }\r\n                            xWall = new typedarrays_1.BooleanArray2D(facetResult.width + 1, facetResult.height + 1);\r\n                            yWall = new typedarrays_1.BooleanArray2D(facetResult.width + 1, facetResult.height + 1);\r\n                            borderStartIndex = -1;\r\n                            for (i = 0; i < f.borderPoints.length; i++) {\r\n                                if ((f.borderPoints[i].x === f.bbox.minX || f.borderPoints[i].x === f.bbox.maxX) ||\r\n                                    (f.borderPoints[i].y === f.bbox.minY || f.borderPoints[i].y === f.bbox.maxY)) {\r\n                                    borderStartIndex = i;\r\n                                    break;\r\n                                }\r\n                            }\r\n                            pt = new facetmanagement_1.PathPoint(f.borderPoints[borderStartIndex], facetmanagement_1.OrientationEnum.Left);\r\n                            // L T R B\r\n                            if (pt.x - 1 < 0 || facetResult.facetMap.get(pt.x - 1, pt.y) !== f.id) {\r\n                                pt.orientation = facetmanagement_1.OrientationEnum.Left;\r\n                            }\r\n                            else if (pt.y - 1 < 0 || facetResult.facetMap.get(pt.x, pt.y - 1) !== f.id) {\r\n                                pt.orientation = facetmanagement_1.OrientationEnum.Top;\r\n                            }\r\n                            else if (pt.x + 1 >= facetResult.width || facetResult.facetMap.get(pt.x + 1, pt.y) !== f.id) {\r\n                                pt.orientation = facetmanagement_1.OrientationEnum.Right;\r\n                            }\r\n                            else if (pt.y + 1 >= facetResult.height || facetResult.facetMap.get(pt.x, pt.y + 1) !== f.id) {\r\n                                pt.orientation = facetmanagement_1.OrientationEnum.Bottom;\r\n                            }\r\n                            path = FacetBorderTracer.getPath(pt, facetResult, f, borderMask, xWall, yWall);\r\n                            f.borderPath = path;\r\n                            if (!(count % 100 === 0)) return [3 /*break*/, 3];\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 2:\r\n                            _b.sent();\r\n                            if (onUpdate != null) {\r\n                                onUpdate(fidx / facetProcessingOrder.length);\r\n                            }\r\n                            _b.label = 3;\r\n                        case 3:\r\n                            count++;\r\n                            _b.label = 4;\r\n                        case 4:\r\n                            fidx++;\r\n                            return [3 /*break*/, 1];\r\n                        case 5:\r\n                            if (onUpdate != null) {\r\n                                onUpdate(1);\r\n                            }\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        /**\r\n         * Returns a border path starting from the given point\r\n         */\r\n        FacetBorderTracer.getPath = function (pt, facetResult, f, borderMask, xWall, yWall) {\r\n            var debug = false;\r\n            var finished = false;\r\n            var count = 0;\r\n            var path = [];\r\n            FacetBorderTracer.addPointToPath(path, pt, xWall, f, yWall);\r\n            // check rotations first, then straight along the ouside and finally diagonally\r\n            // this ensures that bends are always taken as tight as possible\r\n            // so it doesn't skip border points to later loop back to and get stuck (hopefully)\r\n            while (!finished) {\r\n                if (debug) {\r\n                    console.log(pt.x + \" \" + pt.y + \" \" + pt.orientation);\r\n                }\r\n                // yes, technically i could do some trickery to only get the left/top cases\r\n                // by shifting the pixels but that means some more shenanigans in correct order of things\r\n                // so whatever. (And yes I tried it but it wasn't worth the debugging hell that ensued)\r\n                var possibleNextPoints = [];\r\n                //   +---+---+\r\n                //   |  <|   |\r\n                //   +---+---+\r\n                if (pt.orientation === facetmanagement_1.OrientationEnum.Left) {\r\n                    // check rotate to top\r\n                    //   +---+---+\r\n                    //   |   |   |\r\n                    //   +---xnnnn (x = old wall, n = new wall, F = current facet x,y)\r\n                    //   |   x F |\r\n                    //   +---x---+\r\n                    if (((pt.y - 1 >= 0 && facetResult.facetMap.get(pt.x, pt.y - 1) !== f.id) // top exists and is a neighbour facet\r\n                        || pt.y - 1 < 0) // or top doesn't exist, which is the boundary of the image\r\n                        && !yWall.get(pt.x, pt.y)) { // and the wall isn't set yet\r\n                        // can place top _ wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place top _ wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Top);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check rotate to bottom\r\n                    //   +---+---+\r\n                    //   |   |   |\r\n                    //   +---x---+ (x = old wall, n = new wall, F = current facet x,y)\r\n                    //   |   x F |\r\n                    //   +---xnnnn\r\n                    if (((pt.y + 1 < facetResult.height && facetResult.facetMap.get(pt.x, pt.y + 1) !== f.id) // bottom exists and is a neighbour facet\r\n                        || pt.y + 1 >= facetResult.height) // or bottom doesn't exist, which is the boundary of the image\r\n                        && !yWall.get(pt.x, pt.y + 1)) { // and the wall isn't set yet\r\n                        // can place bottom  _ wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place bottom _ wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Bottom);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check upwards\r\n                    //   +---n---+\r\n                    //   |   n   |\r\n                    //   +---x---+ (x = old wall, n = new wall, F = current facet x,y)\r\n                    //   |   x F |\r\n                    //   +---x---+\r\n                    if (pt.y - 1 >= 0 // top exists\r\n                        && facetResult.facetMap.get(pt.x, pt.y - 1) === f.id // and is part of the same facet\r\n                        && (pt.x - 1 < 0 || facetResult.facetMap.get(pt.x - 1, pt.y - 1) !== f.id) // and\r\n                        && borderMask.get(pt.x, pt.y - 1)\r\n                        && !xWall.get(pt.x, pt.y - 1)) {\r\n                        // can place | wall at x,y-1\r\n                        if (debug) {\r\n                            console.log(\"can place left | wall at x,y-1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y - 1), facetmanagement_1.OrientationEnum.Left);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check downwards\r\n                    //   +---x---+\r\n                    //   |   x F |\r\n                    //   +---x---+ (x = old wall, n = new wall, F = current facet x,y)\r\n                    //   |   n   |\r\n                    //   +---n---+\r\n                    if (pt.y + 1 < facetResult.height\r\n                        && facetResult.facetMap.get(pt.x, pt.y + 1) === f.id\r\n                        && (pt.x - 1 < 0 || facetResult.facetMap.get(pt.x - 1, pt.y + 1) !== f.id)\r\n                        && borderMask.get(pt.x, pt.y + 1)\r\n                        && !xWall.get(pt.x, pt.y + 1)) {\r\n                        // can place | wall at x,y+1\r\n                        if (debug) {\r\n                            console.log(\"can place left | wall at x,y+1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y + 1), facetmanagement_1.OrientationEnum.Left);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check left upwards\r\n                    //   +---+---+\r\n                    //   |   |   |\r\n                    //   nnnnx---+ (x = old wall, n = new wall, F = current facet x,y)\r\n                    //   |   x F |\r\n                    //   +---x---+\r\n                    if (pt.y - 1 >= 0 && pt.x - 1 >= 0 // there is a left upwards\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y - 1) === f.id // and it belongs to the same facet\r\n                        && borderMask.get(pt.x - 1, pt.y - 1) // and is on the border\r\n                        && !yWall.get(pt.x - 1, pt.y - 1 + 1) // and the bottom wall isn't set yet\r\n                        && !yWall.get(pt.x, pt.y) // and the path didn't come from the top of the current one to prevent getting a T shaped path (issue: https://i.imgur.com/ggUWuXi.png)\r\n                    ) {\r\n                        // can place bottom _ wall at x-1,y-1\r\n                        if (debug) {\r\n                            console.log(\"can place bottom _ wall at x-1,y-1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x - 1, pt.y - 1), facetmanagement_1.OrientationEnum.Bottom);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check left downwards\r\n                    //   +---x---+\r\n                    //   |   x F |\r\n                    //   nnnnx---+ (x = old wall, n = new wall, F = current facet x,y)\r\n                    //   |   |   |\r\n                    //   +---+---+\r\n                    if (pt.y + 1 < facetResult.height && pt.x - 1 >= 0 // there is a left downwards\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y + 1) === f.id // and belongs to the same facet\r\n                        && borderMask.get(pt.x - 1, pt.y + 1) // and is on the border\r\n                        && !yWall.get(pt.x - 1, pt.y + 1) // and the top wall isn't set yet\r\n                        && !yWall.get(pt.x, pt.y + 1) // and the path didn't come from the bottom of the current point to prevent T shape\r\n                    ) {\r\n                        // can place top _ wall at x-1,y+1\r\n                        if (debug) {\r\n                            console.log(\"can place top _ wall at x-1,y+1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x - 1, pt.y + 1), facetmanagement_1.OrientationEnum.Top);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                }\r\n                else if (pt.orientation === facetmanagement_1.OrientationEnum.Top) {\r\n                    // check rotate to left\r\n                    if (((pt.x - 1 >= 0\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y) !== f.id)\r\n                        || pt.x - 1 < 0)\r\n                        && !xWall.get(pt.x, pt.y)) {\r\n                        // can place left | wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place left | wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Left);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check rotate to right\r\n                    if (((pt.x + 1 < facetResult.width\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y) !== f.id)\r\n                        || pt.x + 1 >= facetResult.width)\r\n                        && !xWall.get(pt.x + 1, pt.y)) {\r\n                        // can place right | wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place right | wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Right);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check leftwards\r\n                    if (pt.x - 1 >= 0\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y) === f.id\r\n                        && (pt.y - 1 < 0 || facetResult.facetMap.get(pt.x - 1, pt.y - 1) !== f.id)\r\n                        && borderMask.get(pt.x - 1, pt.y)\r\n                        && !yWall.get(pt.x - 1, pt.y)) {\r\n                        // can place top _ wall at x-1,y\r\n                        if (debug) {\r\n                            console.log(\"can place top _ wall at x-1,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x - 1, pt.y), facetmanagement_1.OrientationEnum.Top);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check rightwards\r\n                    if (pt.x + 1 < facetResult.width\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y) === f.id\r\n                        && (pt.y - 1 < 0 || facetResult.facetMap.get(pt.x + 1, pt.y - 1) !== f.id)\r\n                        && borderMask.get(pt.x + 1, pt.y)\r\n                        && !yWall.get(pt.x + 1, pt.y)) {\r\n                        // can place top _ wall at x+1,y\r\n                        if (debug) {\r\n                            console.log(\"can place top _ wall at x+1,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x + 1, pt.y), facetmanagement_1.OrientationEnum.Top);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check left upwards\r\n                    if (pt.y - 1 >= 0 && pt.x - 1 >= 0 // there is a left upwards\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y - 1) === f.id // and it belongs to the same facet\r\n                        && borderMask.get(pt.x - 1, pt.y - 1) // and it's part of the border\r\n                        && !xWall.get(pt.x - 1 + 1, pt.y - 1) // the right wall isn't set yet\r\n                        && !xWall.get(pt.x, pt.y) // and the left wall of the current point isn't set yet to prevent |- path\r\n                    ) {\r\n                        // can place right | wall at x-1,y-1\r\n                        if (debug) {\r\n                            console.log(\"can place right | wall at x-1,y-1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x - 1, pt.y - 1), facetmanagement_1.OrientationEnum.Right);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check right upwards\r\n                    if (pt.y - 1 >= 0 && pt.x + 1 < facetResult.width // there is a right upwards\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y - 1) === f.id // and it belongs to the same facet\r\n                        && borderMask.get(pt.x + 1, pt.y - 1) // and it's on the border\r\n                        && !xWall.get(pt.x + 1, pt.y - 1) // and the left wall isn't set yet\r\n                        && !xWall.get(pt.x + 1, pt.y) // and the right wall of the current point isn't set yet to prevent -| path\r\n                    ) {\r\n                        // can place left |  wall at x+1,y-1\r\n                        if (debug) {\r\n                            console.log(\"can place left |  wall at x+1,y-1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x + 1, pt.y - 1), facetmanagement_1.OrientationEnum.Left);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                }\r\n                else if (pt.orientation === facetmanagement_1.OrientationEnum.Right) {\r\n                    // check rotate to top\r\n                    if (((pt.y - 1 >= 0\r\n                        && facetResult.facetMap.get(pt.x, pt.y - 1) !== f.id)\r\n                        || pt.y - 1 < 0)\r\n                        && !yWall.get(pt.x, pt.y)) {\r\n                        // can place top _ wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place top _ wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Top);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check rotate to bottom\r\n                    if (((pt.y + 1 < facetResult.height\r\n                        && facetResult.facetMap.get(pt.x, pt.y + 1) !== f.id)\r\n                        || pt.y + 1 >= facetResult.height)\r\n                        && !yWall.get(pt.x, pt.y + 1)) {\r\n                        // can place bottom  _ wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place bottom _ wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Bottom);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check upwards\r\n                    if (pt.y - 1 >= 0\r\n                        && facetResult.facetMap.get(pt.x, pt.y - 1) === f.id\r\n                        && (pt.x + 1 >= facetResult.width || facetResult.facetMap.get(pt.x + 1, pt.y - 1) !== f.id)\r\n                        && borderMask.get(pt.x, pt.y - 1)\r\n                        && !xWall.get(pt.x + 1, pt.y - 1)) {\r\n                        // can place right | wall at x,y-1\r\n                        if (debug) {\r\n                            console.log(\"can place right | wall at x,y-1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y - 1), facetmanagement_1.OrientationEnum.Right);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check downwards\r\n                    if (pt.y + 1 < facetResult.height\r\n                        && facetResult.facetMap.get(pt.x, pt.y + 1) === f.id\r\n                        && (pt.x + 1 >= facetResult.width || facetResult.facetMap.get(pt.x + 1, pt.y + 1) !== f.id)\r\n                        && borderMask.get(pt.x, pt.y + 1)\r\n                        && !xWall.get(pt.x + 1, pt.y + 1)) {\r\n                        // can place right | wall at x,y+1\r\n                        if (debug) {\r\n                            console.log(\"can place right | wall at x,y+1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y + 1), facetmanagement_1.OrientationEnum.Right);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check right upwards\r\n                    if (pt.y - 1 >= 0 && pt.x + 1 < facetResult.width // there is a right upwards\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y - 1) === f.id // and belongs to the same facet\r\n                        && borderMask.get(pt.x + 1, pt.y - 1) // and is on the border\r\n                        && !yWall.get(pt.x + 1, pt.y - 1 + 1) // and the bottom wall isn't set yet\r\n                        && !yWall.get(pt.x, pt.y) // and the top wall of the current point isn't set to prevent a T shape\r\n                    ) {\r\n                        // can place bottom _ wall at x+1,y-1\r\n                        if (debug) {\r\n                            console.log(\"can place bottom _ wall at x+1,y-1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x + 1, pt.y - 1), facetmanagement_1.OrientationEnum.Bottom);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check right downwards\r\n                    if (pt.y + 1 < facetResult.height && pt.x + 1 < facetResult.width // there is a right downwards\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y + 1) === f.id // and belongs to the same facet\r\n                        && borderMask.get(pt.x + 1, pt.y + 1) // and is on the border\r\n                        && !yWall.get(pt.x + 1, pt.y + 1) // and the top wall isn't visited yet\r\n                        && !yWall.get(pt.x, pt.y + 1) // and the bottom wall of the current point isn't set to prevent a T shape\r\n                    ) {\r\n                        // can place top _ wall at x+1,y+1\r\n                        if (debug) {\r\n                            console.log(\"can place top _ wall at x+1,y+1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x + 1, pt.y + 1), facetmanagement_1.OrientationEnum.Top);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                }\r\n                else if (pt.orientation === facetmanagement_1.OrientationEnum.Bottom) {\r\n                    // check rotate to left\r\n                    if (((pt.x - 1 >= 0\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y) !== f.id)\r\n                        || pt.x - 1 < 0)\r\n                        && !xWall.get(pt.x, pt.y)) {\r\n                        // can place left | wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place left | wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Left);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check rotate to right\r\n                    if (((pt.x + 1 < facetResult.width\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y) !== f.id)\r\n                        || pt.x + 1 >= facetResult.width)\r\n                        && !xWall.get(pt.x + 1, pt.y)) {\r\n                        // can place right | wall at x,y\r\n                        if (debug) {\r\n                            console.log(\"can place right | wall at x,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x, pt.y), facetmanagement_1.OrientationEnum.Right);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check leftwards\r\n                    if (pt.x - 1 >= 0\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y) === f.id\r\n                        && (pt.y + 1 >= facetResult.height || facetResult.facetMap.get(pt.x - 1, pt.y + 1) !== f.id)\r\n                        && borderMask.get(pt.x - 1, pt.y)\r\n                        && !yWall.get(pt.x - 1, pt.y + 1)) {\r\n                        // can place bottom _ wall at x-1,y\r\n                        if (debug) {\r\n                            console.log(\"can place bottom _ wall at x-1,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x - 1, pt.y), facetmanagement_1.OrientationEnum.Bottom);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check rightwards\r\n                    if (pt.x + 1 < facetResult.width\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y) === f.id\r\n                        && (pt.y + 1 >= facetResult.height || facetResult.facetMap.get(pt.x + 1, pt.y + 1) !== f.id)\r\n                        && borderMask.get(pt.x + 1, pt.y)\r\n                        && !yWall.get(pt.x + 1, pt.y + 1)) {\r\n                        // can place top _ wall at x+1,y\r\n                        if (debug) {\r\n                            console.log(\"can place bottom _ wall at x+1,y\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x + 1, pt.y), facetmanagement_1.OrientationEnum.Bottom);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check left downwards\r\n                    if (pt.y + 1 < facetResult.height && pt.x - 1 >= 0 // there is a left downwards\r\n                        && facetResult.facetMap.get(pt.x - 1, pt.y + 1) === f.id // and it's the same facet\r\n                        && borderMask.get(pt.x - 1, pt.y + 1) // and it's on the border\r\n                        && !xWall.get(pt.x - 1 + 1, pt.y + 1) // and the right wall isn't set yet\r\n                        && !xWall.get(pt.x, pt.y) // and the left wall of the current point isn't set yet to prevent |- path\r\n                    ) {\r\n                        // can place right | wall at x-1,y-1\r\n                        if (debug) {\r\n                            console.log(\"can place right | wall at x-1,y+1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x - 1, pt.y + 1), facetmanagement_1.OrientationEnum.Right);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                    // check right downwards\r\n                    if (pt.y + 1 < facetResult.height && pt.x + 1 < facetResult.width // there is a right downwards\r\n                        && facetResult.facetMap.get(pt.x + 1, pt.y + 1) === f.id // and it's the same facet\r\n                        && borderMask.get(pt.x + 1, pt.y + 1) // and it's on the border\r\n                        && !xWall.get(pt.x + 1, pt.y + 1) // and the left wall isn't set yet\r\n                        && !xWall.get(pt.x + 1, pt.y) // and the right wall of the current point isn't set yet to prevent -| path\r\n                    ) {\r\n                        // can place left |  wall at x+1,y+1\r\n                        if (debug) {\r\n                            console.log(\"can place left |  wall at x+1,y+1\");\r\n                        }\r\n                        var nextpt = new facetmanagement_1.PathPoint(new point_1.Point(pt.x + 1, pt.y + 1), facetmanagement_1.OrientationEnum.Left);\r\n                        possibleNextPoints.push(nextpt);\r\n                    }\r\n                }\r\n                if (possibleNextPoints.length > 1) {\r\n                    // TODO it's now not necessary anymore to aggregate all possibilities, the first one is going to be the correct\r\n                    // selection to trace the entire border, so the if checks above can include a skip once ssible point is found again\r\n                    pt = possibleNextPoints[0];\r\n                    FacetBorderTracer.addPointToPath(path, pt, xWall, f, yWall);\r\n                }\r\n                else if (possibleNextPoints.length === 1) {\r\n                    pt = possibleNextPoints[0];\r\n                    FacetBorderTracer.addPointToPath(path, pt, xWall, f, yWall);\r\n                }\r\n                else {\r\n                    finished = true;\r\n                }\r\n            }\r\n            // clear up the walls set for the path so the array can be reused\r\n            for (var _i = 0, path_1 = path; _i < path_1.length; _i++) {\r\n                var pathPoint = path_1[_i];\r\n                switch (pathPoint.orientation) {\r\n                    case facetmanagement_1.OrientationEnum.Left:\r\n                        xWall.set(pathPoint.x, pathPoint.y, false);\r\n                        break;\r\n                    case facetmanagement_1.OrientationEnum.Top:\r\n                        yWall.set(pathPoint.x, pathPoint.y, false);\r\n                        break;\r\n                    case facetmanagement_1.OrientationEnum.Right:\r\n                        xWall.set(pathPoint.x + 1, pathPoint.y, false);\r\n                        break;\r\n                    case facetmanagement_1.OrientationEnum.Bottom:\r\n                        yWall.set(pathPoint.x, pathPoint.y + 1, false);\r\n                        break;\r\n                }\r\n            }\r\n            return path;\r\n        };\r\n        /**\r\n         * Add a point to the border path and ensure the correct xWall/yWalls is set\r\n         */\r\n        FacetBorderTracer.addPointToPath = function (path, pt, xWall, f, yWall) {\r\n            path.push(pt);\r\n            switch (pt.orientation) {\r\n                case facetmanagement_1.OrientationEnum.Left:\r\n                    xWall.set(pt.x, pt.y, true);\r\n                    break;\r\n                case facetmanagement_1.OrientationEnum.Top:\r\n                    yWall.set(pt.x, pt.y, true);\r\n                    break;\r\n                case facetmanagement_1.OrientationEnum.Right:\r\n                    xWall.set(pt.x + 1, pt.y, true);\r\n                    break;\r\n                case facetmanagement_1.OrientationEnum.Bottom:\r\n                    yWall.set(pt.x, pt.y + 1, true);\r\n                    break;\r\n            }\r\n        };\r\n        return FacetBorderTracer;\r\n    }());\r\n    exports.FacetBorderTracer = FacetBorderTracer;\r\n});\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./common\", \"./lib/fill\", \"./structs/boundingbox\", \"./structs/point\", \"./structs/typedarrays\", \"./facetmanagement\"], function (require, exports, common_1, fill_1, boundingbox_1, point_1, typedarrays_1, facetmanagement_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.FacetCreator = void 0;\r\n    var FacetCreator = /** @class */ (function () {\r\n        function FacetCreator() {\r\n        }\r\n        /**\r\n         *  Constructs the facets with its border points for each area of pixels of the same color\r\n         */\r\n        FacetCreator.getFacets = function (width, height, imgColorIndices, onUpdate) {\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var result, visited, count, j, i, colorIndex, facetIndex, facet, _i, _a, f;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            result = new facetmanagement_1.FacetResult();\r\n                            result.width = width;\r\n                            result.height = height;\r\n                            visited = new typedarrays_1.BooleanArray2D(result.width, result.height);\r\n                            // setup facet map & array\r\n                            result.facetMap = new typedarrays_1.Uint32Array2D(result.width, result.height);\r\n                            result.facets = [];\r\n                            count = 0;\r\n                            j = 0;\r\n                            _b.label = 1;\r\n                        case 1:\r\n                            if (!(j < result.height)) return [3 /*break*/, 7];\r\n                            i = 0;\r\n                            _b.label = 2;\r\n                        case 2:\r\n                            if (!(i < result.width)) return [3 /*break*/, 6];\r\n                            colorIndex = imgColorIndices.get(i, j);\r\n                            if (!!visited.get(i, j)) return [3 /*break*/, 4];\r\n                            facetIndex = result.facets.length;\r\n                            facet = FacetCreator.buildFacet(facetIndex, colorIndex, i, j, visited, imgColorIndices, result);\r\n                            result.facets.push(facet);\r\n                            if (!(count % 100 === 0)) return [3 /*break*/, 4];\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 3:\r\n                            _b.sent();\r\n                            if (onUpdate != null) {\r\n                                onUpdate(count / (result.width * result.height));\r\n                            }\r\n                            _b.label = 4;\r\n                        case 4:\r\n                            count++;\r\n                            _b.label = 5;\r\n                        case 5:\r\n                            i++;\r\n                            return [3 /*break*/, 2];\r\n                        case 6:\r\n                            j++;\r\n                            return [3 /*break*/, 1];\r\n                        case 7: return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 8:\r\n                            _b.sent();\r\n                            // fill in the neighbours of all facets by checking the neighbours of the border points\r\n                            for (_i = 0, _a = result.facets; _i < _a.length; _i++) {\r\n                                f = _a[_i];\r\n                                if (f != null) {\r\n                                    FacetCreator.buildFacetNeighbour(f, result);\r\n                                }\r\n                            }\r\n                            if (onUpdate != null) {\r\n                                onUpdate(1);\r\n                            }\r\n                            return [2 /*return*/, result];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        /**\r\n         *  Builds a facet at given x,y using depth first search to visit all pixels of the same color\r\n         */\r\n        FacetCreator.buildFacet = function (facetIndex, facetColorIndex, x, y, visited, imgColorIndices, facetResult) {\r\n            var facet = new facetmanagement_1.Facet();\r\n            facet.id = facetIndex;\r\n            facet.color = facetColorIndex;\r\n            facet.bbox = new boundingbox_1.BoundingBox();\r\n            facet.borderPoints = [];\r\n            facet.neighbourFacetsIsDirty = true; // not built neighbours yet\r\n            facet.neighbourFacets = null;\r\n            (0, fill_1.fill)(x, y, facetResult.width, facetResult.height, function (ptx, pty) { return visited.get(ptx, pty) || imgColorIndices.get(ptx, pty) !== facetColorIndex; }, function (ptx, pty) {\r\n                visited.set(ptx, pty, true);\r\n                facetResult.facetMap.set(ptx, pty, facetIndex);\r\n                facet.pointCount++;\r\n                // determine if the point is a border or not\r\n                /*  const isInnerPoint = (ptx - 1 >= 0 && imgColorIndices.get(ptx - 1, pty) === facetColorIndex) &&\r\n                      (pty - 1 >= 0 && imgColorIndices.get(ptx, pty - 1) === facetColorIndex) &&\r\n                      (ptx + 1 < facetResult.width && imgColorIndices.get(ptx + 1, pty) === facetColorIndex) &&\r\n                      (pty + 1 < facetResult.height && imgColorIndices.get(ptx, pty + 1) === facetColorIndex);\r\n                */\r\n                var isInnerPoint = imgColorIndices.matchAllAround(ptx, pty, facetColorIndex);\r\n                if (!isInnerPoint) {\r\n                    facet.borderPoints.push(new point_1.Point(ptx, pty));\r\n                }\r\n                // update bounding box of facet\r\n                if (ptx > facet.bbox.maxX) {\r\n                    facet.bbox.maxX = ptx;\r\n                }\r\n                if (pty > facet.bbox.maxY) {\r\n                    facet.bbox.maxY = pty;\r\n                }\r\n                if (ptx < facet.bbox.minX) {\r\n                    facet.bbox.minX = ptx;\r\n                }\r\n                if (pty < facet.bbox.minY) {\r\n                    facet.bbox.minY = pty;\r\n                }\r\n            });\r\n            /*\r\n               // using a 1D flattened stack (x*width+y), we can avoid heap allocations of Point objects, which halves the garbage collection time\r\n             let stack: number[] = [];\r\n             stack.push(y * facetResult.width + x);\r\n    \r\n             while (stack.length > 0) {\r\n                 let pt = stack.pop()!;\r\n                 let ptx = pt % facetResult.width;\r\n                 let pty = Math.floor(pt / facetResult.width);\r\n    \r\n                 // if the point wasn't visited before and matches\r\n                 // the same color\r\n                 if (!visited.get(ptx, pty) &&\r\n                     imgColorIndices.get(ptx, pty) == facetColorIndex) {\r\n    \r\n                     visited.set(ptx, pty, true);\r\n                     facetResult.facetMap.set(ptx, pty, facetIndex);\r\n                     facet.pointCount++;\r\n    \r\n                     // determine if the point is a border or not\r\n                     let isInnerPoint = (ptx - 1 >= 0 && imgColorIndices.get(ptx - 1, pty) == facetColorIndex) &&\r\n                         (pty - 1 >= 0 && imgColorIndices.get(ptx, pty - 1) == facetColorIndex) &&\r\n                         (ptx + 1 < facetResult.width && imgColorIndices.get(ptx + 1, pty) == facetColorIndex) &&\r\n                         (pty + 1 < facetResult.height && imgColorIndices.get(ptx, pty + 1) == facetColorIndex);\r\n    \r\n                     if (!isInnerPoint)\r\n                         facet.borderPoints.push(new Point(ptx, pty));\r\n    \r\n                     // update bounding box of facet\r\n                     if (ptx > facet.bbox.maxX) facet.bbox.maxX = ptx;\r\n                     if (pty > facet.bbox.maxY) facet.bbox.maxY = pty;\r\n                     if (ptx < facet.bbox.minX) facet.bbox.minX = ptx;\r\n                     if (pty < facet.bbox.minY) facet.bbox.minY = pty;\r\n    \r\n                     // visit direct adjacent points\r\n                     if (ptx - 1 >= 0 && !visited.get(ptx - 1, pty))\r\n                         stack.push(pty * facetResult.width + (ptx - 1)); //stack.push(new Point(pt.x - 1, pt.y));\r\n                     if (pty - 1 >= 0 && !visited.get(ptx, pty - 1))\r\n                         stack.push((pty - 1) * facetResult.width + ptx); //stack.push(new Point(pt.x, pt.y - 1));\r\n                     if (ptx + 1 < facetResult.width && !visited.get(ptx + 1, pty))\r\n                         stack.push(pty * facetResult.width + (ptx + 1));//stack.push(new Point(pt.x + 1, pt.y));\r\n                     if (pty + 1 < facetResult.height && !visited.get(ptx, pty + 1))\r\n                         stack.push((pty + 1) * facetResult.width + ptx); //stack.push(new Point(pt.x, pt.y + 1));\r\n                 }\r\n             }\r\n             */\r\n            return facet;\r\n        };\r\n        /**\r\n         * Check which neighbour facets the given facet has by checking the neighbour facets at each border point\r\n         */\r\n        FacetCreator.buildFacetNeighbour = function (facet, facetResult) {\r\n            facet.neighbourFacets = [];\r\n            var uniqueFacets = {}; // poor man's set\r\n            for (var _i = 0, _a = facet.borderPoints; _i < _a.length; _i++) {\r\n                var pt = _a[_i];\r\n                if (pt.x - 1 >= 0) {\r\n                    var leftFacetId = facetResult.facetMap.get(pt.x - 1, pt.y);\r\n                    if (leftFacetId !== facet.id) {\r\n                        uniqueFacets[leftFacetId] = true;\r\n                    }\r\n                }\r\n                if (pt.y - 1 >= 0) {\r\n                    var topFacetId = facetResult.facetMap.get(pt.x, pt.y - 1);\r\n                    if (topFacetId !== facet.id) {\r\n                        uniqueFacets[topFacetId] = true;\r\n                    }\r\n                }\r\n                if (pt.x + 1 < facetResult.width) {\r\n                    var rightFacetId = facetResult.facetMap.get(pt.x + 1, pt.y);\r\n                    if (rightFacetId !== facet.id) {\r\n                        uniqueFacets[rightFacetId] = true;\r\n                    }\r\n                }\r\n                if (pt.y + 1 < facetResult.height) {\r\n                    var bottomFacetId = facetResult.facetMap.get(pt.x, pt.y + 1);\r\n                    if (bottomFacetId !== facet.id) {\r\n                        uniqueFacets[bottomFacetId] = true;\r\n                    }\r\n                }\r\n            }\r\n            for (var _b = 0, _c = Object.keys(uniqueFacets); _b < _c.length; _b++) {\r\n                var k = _c[_b];\r\n                if (uniqueFacets.hasOwnProperty(k)) {\r\n                    facet.neighbourFacets.push(parseInt(k));\r\n                }\r\n            }\r\n            // the neighbour array is updated so it's not dirty anymore\r\n            facet.neighbourFacetsIsDirty = false;\r\n        };\r\n        return FacetCreator;\r\n    }());\r\n    exports.FacetCreator = FacetCreator;\r\n});\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./common\", \"./lib/polylabel\", \"./structs/boundingbox\", \"./facetCreator\"], function (require, exports, common_1, polylabel_1, boundingbox_1, facetCreator_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.FacetLabelPlacer = void 0;\r\n    var FacetLabelPlacer = /** @class */ (function () {\r\n        function FacetLabelPlacer() {\r\n        }\r\n        /**\r\n         *  Determines where to place the labels for each facet. This is done by calculating where\r\n         *  in the polygon the largest circle can be contained, also called the pole of inaccessibility\r\n         *  That's the spot where there will be the most room for the label.\r\n         *  One tricky gotcha: neighbour facets can lay completely inside other facets and can overlap the label\r\n         *  if only the outer border of the facet is taken in account. This is solved by adding the neighbours facet polygon that fall\r\n         *  within the facet as additional polygon rings (why does everything look so easy to do yet never is under the hood :/)\r\n         */\r\n        FacetLabelPlacer.buildFacetLabelBounds = function (facetResult, onUpdate) {\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var count, _i, _a, f, polyRings, borderPath, onlyOuterRing, _b, _c, neighbourIdx, neighbourPath, fallsInside, result, innerPadding;\r\n                return __generator(this, function (_d) {\r\n                    switch (_d.label) {\r\n                        case 0:\r\n                            count = 0;\r\n                            _i = 0, _a = facetResult.facets;\r\n                            _d.label = 1;\r\n                        case 1:\r\n                            if (!(_i < _a.length)) return [3 /*break*/, 5];\r\n                            f = _a[_i];\r\n                            if (!(f != null)) return [3 /*break*/, 3];\r\n                            polyRings = [];\r\n                            borderPath = f.getFullPathFromBorderSegments(true);\r\n                            // outer path must be first ring\r\n                            polyRings.push(borderPath);\r\n                            onlyOuterRing = [borderPath];\r\n                            // now add all the neighbours of the facet as \"inner\" rings,\r\n                            // regardless if they are inner or not. These are seen as areas where the label\r\n                            // cannot be placed\r\n                            if (f.neighbourFacetsIsDirty) {\r\n                                facetCreator_1.FacetCreator.buildFacetNeighbour(f, facetResult);\r\n                            }\r\n                            for (_b = 0, _c = f.neighbourFacets; _b < _c.length; _b++) {\r\n                                neighbourIdx = _c[_b];\r\n                                neighbourPath = facetResult.facets[neighbourIdx].getFullPathFromBorderSegments(true);\r\n                                fallsInside = FacetLabelPlacer.doesNeighbourFallInsideInCurrentFacet(neighbourPath, f, onlyOuterRing);\r\n                                if (fallsInside) {\r\n                                    polyRings.push(neighbourPath);\r\n                                }\r\n                            }\r\n                            result = (0, polylabel_1.polylabel)(polyRings);\r\n                            f.labelBounds = new boundingbox_1.BoundingBox();\r\n                            innerPadding = 2 * Math.sqrt(2 * result.distance);\r\n                            f.labelBounds.minX = result.pt.x - innerPadding;\r\n                            f.labelBounds.maxX = result.pt.x + innerPadding;\r\n                            f.labelBounds.minY = result.pt.y - innerPadding;\r\n                            f.labelBounds.maxY = result.pt.y + innerPadding;\r\n                            if (!(count % 100 === 0)) return [3 /*break*/, 3];\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 2:\r\n                            _d.sent();\r\n                            if (onUpdate != null) {\r\n                                onUpdate(f.id / facetResult.facets.length);\r\n                            }\r\n                            _d.label = 3;\r\n                        case 3:\r\n                            count++;\r\n                            _d.label = 4;\r\n                        case 4:\r\n                            _i++;\r\n                            return [3 /*break*/, 1];\r\n                        case 5:\r\n                            if (onUpdate != null) {\r\n                                onUpdate(1);\r\n                            }\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        /**\r\n         *  Checks whether a neighbour border path is fully within the current facet border path\r\n         */\r\n        FacetLabelPlacer.doesNeighbourFallInsideInCurrentFacet = function (neighbourPath, f, onlyOuterRing) {\r\n            var fallsInside = true;\r\n            // fast test to see if the neighbour falls inside the bbox of the facet\r\n            for (var i = 0; i < neighbourPath.length && fallsInside; i++) {\r\n                if (neighbourPath[i].x >= f.bbox.minX && neighbourPath[i].x <= f.bbox.maxX &&\r\n                    neighbourPath[i].y >= f.bbox.minY && neighbourPath[i].y <= f.bbox.maxY) {\r\n                    // ok\r\n                }\r\n                else {\r\n                    fallsInside = false;\r\n                }\r\n            }\r\n            if (fallsInside) {\r\n                // do a more fine grained but more expensive check to see if each of the points fall within the polygon\r\n                for (var i = 0; i < neighbourPath.length && fallsInside; i++) {\r\n                    var distance = (0, polylabel_1.pointToPolygonDist)(neighbourPath[i].x, neighbourPath[i].y, onlyOuterRing);\r\n                    if (distance < 0) {\r\n                        // falls outside\r\n                        fallsInside = false;\r\n                    }\r\n                }\r\n            }\r\n            return fallsInside;\r\n        };\r\n        return FacetLabelPlacer;\r\n    }());\r\n    exports.FacetLabelPlacer = FacetLabelPlacer;\r\n});\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./colorreductionmanagement\", \"./common\", \"./facetCreator\", \"./structs/typedarrays\"], function (require, exports, colorreductionmanagement_1, common_1, facetCreator_1, typedarrays_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.FacetReducer = void 0;\r\n    var FacetReducer = /** @class */ (function () {\r\n        function FacetReducer() {\r\n        }\r\n        /**\r\n         *  Remove all facets that have a pointCount smaller than the given number.\r\n         */\r\n        FacetReducer.reduceFacets = function (smallerThan, removeFacetsFromLargeToSmall, maximumNumberOfFacets, colorsByIndex, facetResult, imgColorIndices, onUpdate) {\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var visitedCache, colorDistances, facetProcessingOrder, curTime, fidx, f, facetCount, startFacetCount, facetProcessingOrder_1, facetToRemove;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            visitedCache = new typedarrays_1.BooleanArray2D(facetResult.width, facetResult.height);\r\n                            colorDistances = colorreductionmanagement_1.ColorReducer.buildColorDistanceMatrix(colorsByIndex);\r\n                            facetProcessingOrder = facetResult.facets.filter(function (f) { return f != null; }).slice(0).sort(function (a, b) { return b.pointCount > a.pointCount ? 1 : (b.pointCount < a.pointCount ? -1 : 0); }).map(function (f) { return f.id; });\r\n                            if (!removeFacetsFromLargeToSmall) {\r\n                                facetProcessingOrder.reverse();\r\n                            }\r\n                            curTime = new Date().getTime();\r\n                            fidx = 0;\r\n                            _a.label = 1;\r\n                        case 1:\r\n                            if (!(fidx < facetProcessingOrder.length)) return [3 /*break*/, 4];\r\n                            f = facetResult.facets[facetProcessingOrder[fidx]];\r\n                            if (!(f != null && f.pointCount < smallerThan)) return [3 /*break*/, 3];\r\n                            FacetReducer.deleteFacet(f.id, facetResult, imgColorIndices, colorDistances, visitedCache);\r\n                            if (!(new Date().getTime() - curTime > 500)) return [3 /*break*/, 3];\r\n                            curTime = new Date().getTime();\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 2:\r\n                            _a.sent();\r\n                            if (onUpdate != null) {\r\n                                onUpdate(0.5 * fidx / facetProcessingOrder.length);\r\n                            }\r\n                            _a.label = 3;\r\n                        case 3:\r\n                            fidx++;\r\n                            return [3 /*break*/, 1];\r\n                        case 4:\r\n                            facetCount = facetResult.facets.filter(function (f) { return f != null; }).length;\r\n                            if (facetCount > maximumNumberOfFacets) {\r\n                                console.log(\"There are still \".concat(facetCount, \" facets, more than the maximum of \").concat(maximumNumberOfFacets, \". Removing the smallest facets\"));\r\n                            }\r\n                            startFacetCount = facetCount;\r\n                            _a.label = 5;\r\n                        case 5:\r\n                            if (!(facetCount > maximumNumberOfFacets)) return [3 /*break*/, 8];\r\n                            facetProcessingOrder_1 = facetResult.facets.filter(function (f) { return f != null; }).slice(0)\r\n                                .sort(function (a, b) { return b.pointCount > a.pointCount ? 1 : (b.pointCount < a.pointCount ? -1 : 0); })\r\n                                .map(function (f) { return f.id; })\r\n                                .reverse();\r\n                            facetToRemove = facetResult.facets[facetProcessingOrder_1[0]];\r\n                            FacetReducer.deleteFacet(facetToRemove.id, facetResult, imgColorIndices, colorDistances, visitedCache);\r\n                            facetCount = facetResult.facets.filter(function (f) { return f != null; }).length;\r\n                            if (!(new Date().getTime() - curTime > 500)) return [3 /*break*/, 7];\r\n                            curTime = new Date().getTime();\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 6:\r\n                            _a.sent();\r\n                            if (onUpdate != null) {\r\n                                onUpdate(0.5 + 0.5 - (facetCount - maximumNumberOfFacets) / (startFacetCount - maximumNumberOfFacets));\r\n                            }\r\n                            _a.label = 7;\r\n                        case 7: return [3 /*break*/, 5];\r\n                        case 8:\r\n                            // this.trimFacets(facetResult, imgColorIndices, colorDistances, visitedCache);\r\n                            if (onUpdate != null) {\r\n                                onUpdate(1);\r\n                            }\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        // /**\r\n        //  * Trims facets with narrow paths either horizontally or vertically, potentially splitting the facet into multiple facets\r\n        //  */\r\n        // public static trimFacets(facetResult: FacetResult, imgColorIndices: Uint8Array2D, colorDistances: number[][], visitedArrayCache: BooleanArray2D) {\r\n        //     for (const facet of facetResult.facets) {\r\n        //         if (facet !== null) {\r\n        //             const facetPointsToReallocate: Point[] = [];\r\n        //             for (let y: number = facet.bbox.minY; y <= facet.bbox.maxY; y++) {\r\n        //                 for (let x: number = facet.bbox.minX; x <= facet.bbox.maxX; x++) {\r\n        //                     if (x > 0 && y > 0 && x < facetResult.width - 1 && y < facetResult.height - 1 &&\r\n        //                         facetResult.facetMap.get(x, y) === facet.id) {\r\n        //                         // check if isolated horizontally\r\n        //                         const top = facetResult.facetMap.get(x, y - 1);\r\n        //                         const bottom = facetResult.facetMap.get(x, y + 1);\r\n        //                         if (top !== facet.id && bottom !== facet.id) {\r\n        //                             // . ? .\r\n        //                             // . F .\r\n        //                             // . ? .\r\n        //                             // mark pixel of facet that it should be removed\r\n        //                             facetPointsToReallocate.push(new Point(x, y));\r\n        //                             const closestNeighbour = FacetReducer.getClosestNeighbourForPixel(facet, facetResult, x, y, colorDistances);\r\n        //                             // copy over color of closest neighbour\r\n        //                             imgColorIndices.set(x, y, facetResult.facets[closestNeighbour]!.color);\r\n        //                             console.log(\"Flagged \" + x + \",\" + y + \" to trim\");\r\n        //                         }\r\n        //                     }\r\n        //                 }\r\n        //             }\r\n        //             if (facetPointsToReallocate.length > 0) {\r\n        //                 FacetReducer.rebuildForFacetChange(visitedArrayCache, facet, imgColorIndices, facetResult);\r\n        //             }\r\n        //         }\r\n        //     }\r\n        // }\r\n        /**\r\n         * Deletes a facet. All points belonging to the facet are moved to the nearest neighbour facet\r\n         * based on the distance of the neighbour border points. This results in a voronoi like filling in of the\r\n         * void the deletion made\r\n         */\r\n        FacetReducer.deleteFacet = function (facetIdToRemove, facetResult, imgColorIndices, colorDistances, visitedArrayCache) {\r\n            var facetToRemove = facetResult.facets[facetIdToRemove];\r\n            if (facetToRemove === null) { // already removed\r\n                return;\r\n            }\r\n            if (facetToRemove.neighbourFacetsIsDirty) {\r\n                facetCreator_1.FacetCreator.buildFacetNeighbour(facetToRemove, facetResult);\r\n            }\r\n            if (facetToRemove.neighbourFacets.length > 0) {\r\n                // there are many small facets, it's faster to just iterate over all points within its bounding box\r\n                // and seeing which belong to the facet than to keep track of the inner points (along with the border points)\r\n                // per facet, because that generates a lot of extra heap objects that need to be garbage collected each time\r\n                // a facet is rebuilt\r\n                for (var j = facetToRemove.bbox.minY; j <= facetToRemove.bbox.maxY; j++) {\r\n                    for (var i = facetToRemove.bbox.minX; i <= facetToRemove.bbox.maxX; i++) {\r\n                        if (facetResult.facetMap.get(i, j) === facetToRemove.id) {\r\n                            var closestNeighbour = FacetReducer.getClosestNeighbourForPixel(facetToRemove, facetResult, i, j, colorDistances);\r\n                            if (closestNeighbour !== -1) {\r\n                                // copy over color of closest neighbour\r\n                                imgColorIndices.set(i, j, facetResult.facets[closestNeighbour].color);\r\n                            }\r\n                            else {\r\n                                console.warn(\"No closest neighbour found for point \".concat(i, \",\").concat(j));\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                console.warn(\"Facet \".concat(facetToRemove.id, \" does not have any neighbours\"));\r\n            }\r\n            // Rebuild all the neighbour facets that have been changed. While it could probably be faster by just adding the points manually\r\n            // to the facet map and determine if the border points are still valid, it's more complex than that. It's possible that due to the change in points\r\n            // that 2 neighbours of the same colors have become linked and need to merged as well. So it's easier to just rebuild the entire facet\r\n            FacetReducer.rebuildForFacetChange(visitedArrayCache, facetToRemove, imgColorIndices, facetResult);\r\n            // now mark the facet to remove as deleted\r\n            facetResult.facets[facetToRemove.id] = null;\r\n        };\r\n        FacetReducer.rebuildForFacetChange = function (visitedArrayCache, facet, imgColorIndices, facetResult) {\r\n            FacetReducer.rebuildChangedNeighbourFacets(visitedArrayCache, facet, imgColorIndices, facetResult);\r\n            // sanity check: make sure that all points have been replaced by neighbour facets. It's possible that some points will have\r\n            // been left out because there is no continuity with the neighbour points\r\n            // this occurs for diagonal points to the neighbours and more often when the closest\r\n            // color is chosen when distances are equal.\r\n            // It's probably possible to enforce that this will never happen in the above code but\r\n            // this is a constraint that is expensive to enforce and doesn't happen all that much\r\n            // so instead try and merge if with any of its direct neighbours if possible\r\n            var needsToRebuild = false;\r\n            for (var y = facet.bbox.minY; y <= facet.bbox.maxY; y++) {\r\n                for (var x = facet.bbox.minX; x <= facet.bbox.maxX; x++) {\r\n                    if (facetResult.facetMap.get(x, y) === facet.id) {\r\n                        console.warn(\"Point \".concat(x, \",\").concat(y, \" was reallocated to neighbours for facet \").concat(facet.id));\r\n                        needsToRebuild = true;\r\n                        if (x - 1 >= 0 && facetResult.facetMap.get(x - 1, y) !== facet.id && facetResult.facets[facetResult.facetMap.get(x - 1, y)] !== null) {\r\n                            imgColorIndices.set(x, y, facetResult.facets[facetResult.facetMap.get(x - 1, y)].color);\r\n                        }\r\n                        else if (y - 1 >= 0 && facetResult.facetMap.get(x, y - 1) !== facet.id && facetResult.facets[facetResult.facetMap.get(x, y - 1)] !== null) {\r\n                            imgColorIndices.set(x, y, facetResult.facets[facetResult.facetMap.get(x, y - 1)].color);\r\n                        }\r\n                        else if (x + 1 < facetResult.width && facetResult.facetMap.get(x + 1, y) !== facet.id && facetResult.facets[facetResult.facetMap.get(x + 1, y)] !== null) {\r\n                            imgColorIndices.set(x, y, facetResult.facets[facetResult.facetMap.get(x + 1, y)].color);\r\n                        }\r\n                        else if (y + 1 < facetResult.height && facetResult.facetMap.get(x, y + 1) !== facet.id && facetResult.facets[facetResult.facetMap.get(x, y + 1)] !== null) {\r\n                            imgColorIndices.set(x, y, facetResult.facets[facetResult.facetMap.get(x, y + 1)].color);\r\n                        }\r\n                        else {\r\n                            console.error(\"Unable to reallocate point \".concat(x, \",\").concat(y));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // now we need to go through the thing again to build facets and update the neighbours\r\n            if (needsToRebuild) {\r\n                FacetReducer.rebuildChangedNeighbourFacets(visitedArrayCache, facet, imgColorIndices, facetResult);\r\n            }\r\n        };\r\n        /**\r\n         * Determines the closest neighbour for a given pixel of a facet, based on the closest distance to the neighbour AND the when tied, the closest color\r\n         */\r\n        FacetReducer.getClosestNeighbourForPixel = function (facetToRemove, facetResult, x, y, colorDistances) {\r\n            var closestNeighbour = -1;\r\n            var minDistance = Number.MAX_VALUE;\r\n            var minColorDistance = Number.MAX_VALUE;\r\n            // ensure the neighbour facets is up to date if it was marked as dirty\r\n            if (facetToRemove.neighbourFacetsIsDirty) {\r\n                facetCreator_1.FacetCreator.buildFacetNeighbour(facetToRemove, facetResult);\r\n            }\r\n            // determine which neighbour will receive the current point based on the distance, and if there are more with the same\r\n            // distance, then take the neighbour with the closes color\r\n            for (var _i = 0, _a = facetToRemove.neighbourFacets; _i < _a.length; _i++) {\r\n                var neighbourIdx = _a[_i];\r\n                var neighbour = facetResult.facets[neighbourIdx];\r\n                if (neighbour != null) {\r\n                    for (var _b = 0, _c = neighbour.borderPoints; _b < _c.length; _b++) {\r\n                        var bpt = _c[_b];\r\n                        var distance = bpt.distanceToCoord(x, y);\r\n                        if (distance < minDistance) {\r\n                            minDistance = distance;\r\n                            closestNeighbour = neighbourIdx;\r\n                            minColorDistance = Number.MAX_VALUE; // reset color distance\r\n                        }\r\n                        else if (distance === minDistance) {\r\n                            // if the distance is equal as the min distance\r\n                            // then see if the neighbour's color is closer to the current color\r\n                            // note: this causes morepoints to be reallocated to different neighbours\r\n                            // in the sanity check later, but still yields a better visual result\r\n                            var colorDistance = colorDistances[facetToRemove.color][neighbour.color];\r\n                            if (colorDistance < minColorDistance) {\r\n                                minColorDistance = colorDistance;\r\n                                closestNeighbour = neighbourIdx;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return closestNeighbour;\r\n        };\r\n        /**\r\n         *  Rebuilds the given changed facets\r\n         */\r\n        FacetReducer.rebuildChangedNeighbourFacets = function (visitedArrayCache, facetToRemove, imgColorIndices, facetResult) {\r\n            var changedNeighboursSet = {};\r\n            if (facetToRemove.neighbourFacetsIsDirty) {\r\n                facetCreator_1.FacetCreator.buildFacetNeighbour(facetToRemove, facetResult);\r\n            }\r\n            for (var _i = 0, _a = facetToRemove.neighbourFacets; _i < _a.length; _i++) {\r\n                var neighbourIdx = _a[_i];\r\n                var neighbour = facetResult.facets[neighbourIdx];\r\n                if (neighbour != null) {\r\n                    // re-evaluate facet\r\n                    // track all the facets that needs to have their neighbour list updated, which is also going to be all the neighbours of the neighbours that are being updated\r\n                    changedNeighboursSet[neighbourIdx] = true;\r\n                    if (neighbour.neighbourFacetsIsDirty) {\r\n                        facetCreator_1.FacetCreator.buildFacetNeighbour(neighbour, facetResult);\r\n                    }\r\n                    for (var _b = 0, _c = neighbour.neighbourFacets; _b < _c.length; _b++) {\r\n                        var n = _c[_b];\r\n                        changedNeighboursSet[n] = true;\r\n                    }\r\n                    // rebuild the neighbour facet\r\n                    var newFacet = facetCreator_1.FacetCreator.buildFacet(neighbourIdx, neighbour.color, neighbour.borderPoints[0].x, neighbour.borderPoints[0].y, visitedArrayCache, imgColorIndices, facetResult);\r\n                    facetResult.facets[neighbourIdx] = newFacet;\r\n                    // it's possible that any of the neighbour facets are now overlapping\r\n                    // because if for example facet Red - Green - Red, Green is removed\r\n                    // then it will become Red - Red and both facets will overlap\r\n                    // this means the facet will have 0 points remaining\r\n                    if (newFacet.pointCount === 0) {\r\n                        // remove the empty facet as well\r\n                        facetResult.facets[neighbourIdx] = null;\r\n                    }\r\n                }\r\n            }\r\n            // reset the visited array for all neighbours\r\n            // while the visited array could be recreated per facet to remove, it's quite big and introduces\r\n            // a lot of allocation / cleanup overhead. Due to the size of the facets it's usually faster\r\n            // to just flag every point of the facet as false again\r\n            if (facetToRemove.neighbourFacetsIsDirty) {\r\n                facetCreator_1.FacetCreator.buildFacetNeighbour(facetToRemove, facetResult);\r\n            }\r\n            for (var _d = 0, _e = facetToRemove.neighbourFacets; _d < _e.length; _d++) {\r\n                var neighbourIdx = _e[_d];\r\n                var neighbour = facetResult.facets[neighbourIdx];\r\n                if (neighbour != null) {\r\n                    for (var y = neighbour.bbox.minY; y <= neighbour.bbox.maxY; y++) {\r\n                        for (var x = neighbour.bbox.minX; x <= neighbour.bbox.maxX; x++) {\r\n                            if (facetResult.facetMap.get(x, y) === neighbour.id) {\r\n                                visitedArrayCache.set(x, y, false);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // rebuild neighbour array for affected neighbours\r\n            for (var _f = 0, _g = Object.keys(changedNeighboursSet); _f < _g.length; _f++) {\r\n                var k = _g[_f];\r\n                if (changedNeighboursSet.hasOwnProperty(k)) {\r\n                    var neighbourIdx = parseInt(k);\r\n                    var f = facetResult.facets[neighbourIdx];\r\n                    if (f != null) {\r\n                        // it's a lot faster when deferring the neighbour array updates\r\n                        // because a lot of facets that are deleted share the same facet neighbours\r\n                        // and removing the unnecessary neighbour array checks until they it's needed\r\n                        // speeds things up significantly\r\n                        // FacetCreator.buildFacetNeighbour(f, facetResult);\r\n                        f.neighbourFacets = null;\r\n                        f.neighbourFacetsIsDirty = true;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        return FacetReducer;\r\n    }());\r\n    exports.FacetReducer = FacetReducer;\r\n});\r\n","var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine([\"require\", \"exports\", \"./structs/point\"], function (require, exports, point_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.FacetResult = exports.Facet = exports.PathPoint = exports.OrientationEnum = void 0;\r\n    var OrientationEnum;\r\n    (function (OrientationEnum) {\r\n        OrientationEnum[OrientationEnum[\"Left\"] = 0] = \"Left\";\r\n        OrientationEnum[OrientationEnum[\"Top\"] = 1] = \"Top\";\r\n        OrientationEnum[OrientationEnum[\"Right\"] = 2] = \"Right\";\r\n        OrientationEnum[OrientationEnum[\"Bottom\"] = 3] = \"Bottom\";\r\n    })(OrientationEnum = exports.OrientationEnum || (exports.OrientationEnum = {}));\r\n    /**\r\n     * PathPoint is a point with an orientation that indicates which wall border is set\r\n     */\r\n    var PathPoint = /** @class */ (function (_super) {\r\n        __extends(PathPoint, _super);\r\n        function PathPoint(pt, orientation) {\r\n            var _this = _super.call(this, pt.x, pt.y) || this;\r\n            _this.orientation = orientation;\r\n            return _this;\r\n        }\r\n        PathPoint.prototype.getWallX = function () {\r\n            var x = this.x;\r\n            if (this.orientation === OrientationEnum.Left) {\r\n                x -= 0.5;\r\n            }\r\n            else if (this.orientation === OrientationEnum.Right) {\r\n                x += 0.5;\r\n            }\r\n            return x;\r\n        };\r\n        PathPoint.prototype.getWallY = function () {\r\n            var y = this.y;\r\n            if (this.orientation === OrientationEnum.Top) {\r\n                y -= 0.5;\r\n            }\r\n            else if (this.orientation === OrientationEnum.Bottom) {\r\n                y += 0.5;\r\n            }\r\n            return y;\r\n        };\r\n        PathPoint.prototype.getNeighbour = function (facetResult) {\r\n            switch (this.orientation) {\r\n                case OrientationEnum.Left:\r\n                    if (this.x - 1 >= 0) {\r\n                        return facetResult.facetMap.get(this.x - 1, this.y);\r\n                    }\r\n                    break;\r\n                case OrientationEnum.Right:\r\n                    if (this.x + 1 < facetResult.width) {\r\n                        return facetResult.facetMap.get(this.x + 1, this.y);\r\n                    }\r\n                    break;\r\n                case OrientationEnum.Top:\r\n                    if (this.y - 1 >= 0) {\r\n                        return facetResult.facetMap.get(this.x, this.y - 1);\r\n                    }\r\n                    break;\r\n                case OrientationEnum.Bottom:\r\n                    if (this.y + 1 < facetResult.height) {\r\n                        return facetResult.facetMap.get(this.x, this.y + 1);\r\n                    }\r\n                    break;\r\n            }\r\n            return -1;\r\n        };\r\n        PathPoint.prototype.toString = function () {\r\n            return this.x + \",\" + this.y + \" \" + this.orientation;\r\n        };\r\n        return PathPoint;\r\n    }(point_1.Point));\r\n    exports.PathPoint = PathPoint;\r\n    /**\r\n     *  A facet that represents an area of pixels of the same color\r\n     */\r\n    var Facet = /** @class */ (function () {\r\n        function Facet() {\r\n            this.pointCount = 0;\r\n            /**\r\n             * Flag indicating if the neighbourfacets array is dirty. If it is, the neighbourfacets *have* to be rebuild\r\n             * Before it can be used. This is useful to defer the rebuilding of the array until it's actually needed\r\n             * and can remove a lot of duplicate building of the array because multiple facets were hitting the same neighbour\r\n             * (over 50% on test images)\r\n             */\r\n            this.neighbourFacetsIsDirty = false;\r\n        }\r\n        Facet.prototype.getFullPathFromBorderSegments = function (useWalls) {\r\n            var newpath = [];\r\n            var addPoint = function (pt) {\r\n                if (useWalls) {\r\n                    newpath.push(new point_1.Point(pt.getWallX(), pt.getWallY()));\r\n                }\r\n                else {\r\n                    newpath.push(new point_1.Point(pt.x, pt.y));\r\n                }\r\n            };\r\n            var lastSegment = null;\r\n            for (var _i = 0, _a = this.borderSegments; _i < _a.length; _i++) {\r\n                var seg = _a[_i];\r\n                // fix for the continuitity of the border segments. If transition points between border segments on the path aren't repeated, the\r\n                // borders of the facets aren't always matching up leaving holes when rendered\r\n                if (lastSegment != null) {\r\n                    if (lastSegment.reverseOrder) {\r\n                        addPoint(lastSegment.originalSegment.points[0]);\r\n                    }\r\n                    else {\r\n                        addPoint(lastSegment.originalSegment.points[lastSegment.originalSegment.points.length - 1]);\r\n                    }\r\n                }\r\n                for (var i = 0; i < seg.originalSegment.points.length; i++) {\r\n                    var idx = seg.reverseOrder ? (seg.originalSegment.points.length - 1 - i) : i;\r\n                    addPoint(seg.originalSegment.points[idx]);\r\n                }\r\n                lastSegment = seg;\r\n            }\r\n            return newpath;\r\n        };\r\n        return Facet;\r\n    }());\r\n    exports.Facet = Facet;\r\n    /**\r\n     *  Result of the facet construction, both as a map and as an array.\r\n     *  Facets in the array can be null when they've been deleted\r\n     */\r\n    var FacetResult = /** @class */ (function () {\r\n        function FacetResult() {\r\n        }\r\n        return FacetResult;\r\n    }());\r\n    exports.FacetResult = FacetResult;\r\n});\r\n","/**\r\n * Module that provides function the GUI uses and updates the DOM accordingly\r\n */\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./common\", \"./guiprocessmanager\", \"./settings\"], function (require, exports, common_1, guiprocessmanager_1, settings_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.loadExample = exports.downloadSVG = exports.downloadPNG = exports.downloadPalettePng = exports.updateOutput = exports.process = exports.parseSettings = exports.log = exports.timeEnd = exports.time = void 0;\r\n    var processResult = null;\r\n    var cancellationToken = new common_1.CancellationToken();\r\n    var timers = {};\r\n    function time(name) {\r\n        console.time(name);\r\n        timers[name] = new Date();\r\n    }\r\n    exports.time = time;\r\n    function timeEnd(name) {\r\n        console.timeEnd(name);\r\n        var ms = new Date().getTime() - timers[name].getTime();\r\n        log(name + \": \" + ms + \"ms\");\r\n        delete timers[name];\r\n    }\r\n    exports.timeEnd = timeEnd;\r\n    function log(str) {\r\n        $(\"#log\").append(\"<br/><span>\" + str + \"</span>\");\r\n    }\r\n    exports.log = log;\r\n    function parseSettings() {\r\n        var settings = new settings_1.Settings();\r\n        if ($(\"#optColorSpaceRGB\").prop(\"checked\")) {\r\n            settings.kMeansClusteringColorSpace = settings_1.ClusteringColorSpace.RGB;\r\n        }\r\n        else if ($(\"#optColorSpaceHSL\").prop(\"checked\")) {\r\n            settings.kMeansClusteringColorSpace = settings_1.ClusteringColorSpace.HSL;\r\n        }\r\n        else if ($(\"#optColorSpaceRGB\").prop(\"checked\")) {\r\n            settings.kMeansClusteringColorSpace = settings_1.ClusteringColorSpace.LAB;\r\n        }\r\n        if ($(\"#optFacetRemovalLargestToSmallest\").prop(\"checked\")) {\r\n            settings.removeFacetsFromLargeToSmall = true;\r\n        }\r\n        else {\r\n            settings.removeFacetsFromLargeToSmall = false;\r\n        }\r\n        settings.randomSeed = parseInt($(\"#txtRandomSeed\").val() + \"\");\r\n        settings.kMeansNrOfClusters = parseInt($(\"#txtNrOfClusters\").val() + \"\");\r\n        settings.kMeansMinDeltaDifference = parseFloat($(\"#txtClusterPrecision\").val() + \"\");\r\n        settings.removeFacetsSmallerThanNrOfPoints = parseInt($(\"#txtRemoveFacetsSmallerThan\").val() + \"\");\r\n        settings.maximumNumberOfFacets = parseInt($(\"#txtMaximumNumberOfFacets\").val() + \"\");\r\n        settings.nrOfTimesToHalveBorderSegments = parseInt($(\"#txtNrOfTimesToHalveBorderSegments\").val() + \"\");\r\n        settings.narrowPixelStripCleanupRuns = parseInt($(\"#txtNarrowPixelStripCleanupRuns\").val() + \"\");\r\n        settings.resizeImageIfTooLarge = $(\"#chkResizeImage\").prop(\"checked\");\r\n        settings.resizeImageWidth = parseInt($(\"#txtResizeWidth\").val() + \"\");\r\n        settings.resizeImageHeight = parseInt($(\"#txtResizeHeight\").val() + \"\");\r\n        var restrictedColorLines = ($(\"#txtKMeansColorRestrictions\").val() + \"\").split(\"\\n\");\r\n        for (var _i = 0, restrictedColorLines_1 = restrictedColorLines; _i < restrictedColorLines_1.length; _i++) {\r\n            var line = restrictedColorLines_1[_i];\r\n            var tline = line.trim();\r\n            if (tline.indexOf(\"//\") === 0) {\r\n                // comment, skip\r\n            }\r\n            else {\r\n                var rgbparts = tline.split(\",\");\r\n                if (rgbparts.length === 3) {\r\n                    var red = parseInt(rgbparts[0]);\r\n                    var green = parseInt(rgbparts[1]);\r\n                    var blue = parseInt(rgbparts[2]);\r\n                    if (red < 0)\r\n                        red = 0;\r\n                    if (red > 255)\r\n                        red = 255;\r\n                    if (green < 0)\r\n                        green = 0;\r\n                    if (green > 255)\r\n                        green = 255;\r\n                    if (blue < 0)\r\n                        blue = 0;\r\n                    if (blue > 255)\r\n                        blue = 255;\r\n                    if (!isNaN(red) && !isNaN(green) && !isNaN(blue)) {\r\n                        settings.kMeansColorRestrictions.push([red, green, blue]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return settings;\r\n    }\r\n    exports.parseSettings = parseSettings;\r\n    function process() {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var settings, tabsOutput, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 3, , 4]);\r\n                        settings = parseSettings();\r\n                        // cancel old process & create new\r\n                        cancellationToken.isCancelled = true;\r\n                        cancellationToken = new common_1.CancellationToken();\r\n                        return [4 /*yield*/, guiprocessmanager_1.GUIProcessManager.process(settings, cancellationToken)];\r\n                    case 1:\r\n                        processResult = _a.sent();\r\n                        return [4 /*yield*/, updateOutput()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        tabsOutput = M.Tabs.getInstance(document.getElementById(\"tabsOutput\"));\r\n                        tabsOutput.select(\"output-pane\");\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        log(\"Error: \");\r\n                        return [3 /*break*/, 4];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    exports.process = process;\r\n    function updateOutput() {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var showLabels, fill, stroke, sizeMultiplier, fontSize, fontColor, svg;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(processResult != null)) return [3 /*break*/, 2];\r\n                        showLabels = $(\"#chkShowLabels\").prop(\"checked\");\r\n                        fill = $(\"#chkFillFacets\").prop(\"checked\");\r\n                        stroke = $(\"#chkShowBorders\").prop(\"checked\");\r\n                        sizeMultiplier = parseInt($(\"#txtSizeMultiplier\").val() + \"\");\r\n                        fontSize = parseInt($(\"#txtLabelFontSize\").val() + \"\");\r\n                        fontColor = $(\"#txtLabelFontColor\").val() + \"\";\r\n                        $(\"#statusSVGGenerate\").css(\"width\", \"0%\");\r\n                        $(\".status.SVGGenerate\").removeClass(\"complete\");\r\n                        $(\".status.SVGGenerate\").addClass(\"active\");\r\n                        return [4 /*yield*/, guiprocessmanager_1.GUIProcessManager.createSVG(processResult.facetResult, processResult.colorsByIndex, sizeMultiplier, fill, stroke, showLabels, fontSize, fontColor, function (progress) {\r\n                                if (cancellationToken.isCancelled) {\r\n                                    throw new Error(\"Cancelled\");\r\n                                }\r\n                                $(\"#statusSVGGenerate\").css(\"width\", Math.round(progress * 100) + \"%\");\r\n                            })];\r\n                    case 1:\r\n                        svg = _a.sent();\r\n                        $(\"#svgContainer\").empty().append(svg);\r\n                        $(\"#palette\").empty().append(createPaletteHtml(processResult.colorsByIndex));\r\n                        $(\"#palette .color\").tooltip();\r\n                        $(\".status\").removeClass(\"active\");\r\n                        $(\".status.SVGGenerate\").addClass(\"complete\");\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    exports.updateOutput = updateOutput;\r\n    function createPaletteHtml(colorsByIndex) {\r\n        var html = \"\";\r\n        for (var c = 0; c < colorsByIndex.length; c++) {\r\n            var style = \"background-color: \" + \"rgb(\".concat(colorsByIndex[c][0], \",\").concat(colorsByIndex[c][1], \",\").concat(colorsByIndex[c][2], \")\");\r\n            html += \"<div class=\\\"color\\\" class=\\\"tooltipped\\\" style=\\\"\".concat(style, \"\\\" data-tooltip=\\\"\").concat(colorsByIndex[c][0], \",\").concat(colorsByIndex[c][1], \",\").concat(colorsByIndex[c][2], \"\\\">\").concat(c, \"</div>\");\r\n        }\r\n        return $(html);\r\n    }\r\n    function downloadPalettePng() {\r\n        if (processResult == null) {\r\n            return;\r\n        }\r\n        var colorsByIndex = processResult.colorsByIndex;\r\n        var canvas = document.createElement(\"canvas\");\r\n        var nrOfItemsPerRow = 10;\r\n        var nrRows = Math.ceil(colorsByIndex.length / nrOfItemsPerRow);\r\n        var margin = 10;\r\n        var cellWidth = 80;\r\n        var cellHeight = 70;\r\n        canvas.width = margin + nrOfItemsPerRow * (cellWidth + margin);\r\n        canvas.height = margin + nrRows * (cellHeight + margin);\r\n        var ctx = canvas.getContext(\"2d\");\r\n        ctx.translate(0.5, 0.5);\r\n        ctx.fillStyle = \"white\";\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n        for (var i = 0; i < colorsByIndex.length; i++) {\r\n            var color = colorsByIndex[i];\r\n            var x = margin + (i % nrOfItemsPerRow) * (cellWidth + margin);\r\n            var y = margin + Math.floor(i / nrOfItemsPerRow) * (cellHeight + margin);\r\n            ctx.fillStyle = \"rgb(\".concat(color[0], \", \").concat(color[1], \", \").concat(color[2], \")\");\r\n            ctx.fillRect(x, y, cellWidth, cellHeight - 20);\r\n            ctx.strokeStyle = \"#888\";\r\n            ctx.strokeRect(x, y, cellWidth, cellHeight - 20);\r\n            var nrText = i + \"\";\r\n            ctx.fillStyle = \"black\";\r\n            ctx.strokeStyle = \"#CCC\";\r\n            ctx.font = \"20px Tahoma\";\r\n            var nrTextSize = ctx.measureText(nrText);\r\n            ctx.lineWidth = 2;\r\n            ctx.strokeText(nrText, x + cellWidth / 2 - nrTextSize.width / 2, y + cellHeight / 2 - 5);\r\n            ctx.fillText(nrText, x + cellWidth / 2 - nrTextSize.width / 2, y + cellHeight / 2 - 5);\r\n            ctx.lineWidth = 1;\r\n            ctx.font = \"10px Tahoma\";\r\n            var rgbText = \"RGB: \" + Math.floor(color[0]) + \",\" + Math.floor(color[1]) + \",\" + Math.floor(color[2]);\r\n            var rgbTextSize = ctx.measureText(rgbText);\r\n            ctx.fillStyle = \"black\";\r\n            ctx.fillText(rgbText, x + cellWidth / 2 - rgbTextSize.width / 2, y + cellHeight - 10);\r\n        }\r\n        var dataURL = canvas.toDataURL(\"image/png\");\r\n        var dl = document.createElement(\"a\");\r\n        document.body.appendChild(dl);\r\n        dl.setAttribute(\"href\", dataURL);\r\n        dl.setAttribute(\"download\", \"palette.png\");\r\n        dl.click();\r\n    }\r\n    exports.downloadPalettePng = downloadPalettePng;\r\n    function downloadPNG() {\r\n        if ($(\"#svgContainer svg\").length > 0) {\r\n            saveSvgAsPng($(\"#svgContainer svg\").get(0), \"paintbynumbers.png\");\r\n        }\r\n    }\r\n    exports.downloadPNG = downloadPNG;\r\n    function downloadSVG() {\r\n        if ($(\"#svgContainer svg\").length > 0) {\r\n            var svgEl = $(\"#svgContainer svg\").get(0);\r\n            svgEl.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\r\n            var svgData = svgEl.outerHTML;\r\n            var preface = '<?xml version=\"1.0\" standalone=\"no\"?>\\r\\n';\r\n            var svgBlob = new Blob([preface, svgData], { type: \"image/svg+xml;charset=utf-8\" });\r\n            var svgUrl = URL.createObjectURL(svgBlob);\r\n            var downloadLink = document.createElement(\"a\");\r\n            downloadLink.href = svgUrl;\r\n            downloadLink.download = \"paintbynumbers.svg\";\r\n            document.body.appendChild(downloadLink);\r\n            downloadLink.click();\r\n            document.body.removeChild(downloadLink);\r\n            /*\r\n            var svgAsXML = (new XMLSerializer).serializeToString(<any>$(\"#svgContainer svg\").get(0));\r\n            let dataURL = \"data:image/svg+xml,\" + encodeURIComponent(svgAsXML);\r\n            var dl = document.createElement(\"a\");\r\n            document.body.appendChild(dl);\r\n            dl.setAttribute(\"href\", dataURL);\r\n            dl.setAttribute(\"download\", \"paintbynumbers.svg\");\r\n            dl.click();\r\n            */\r\n        }\r\n    }\r\n    exports.downloadSVG = downloadSVG;\r\n    function loadExample(imgId) {\r\n        // load image\r\n        var img = document.getElementById(imgId);\r\n        var c = document.getElementById(\"canvas\");\r\n        var ctx = c.getContext(\"2d\");\r\n        c.width = img.naturalWidth;\r\n        c.height = img.naturalHeight;\r\n        ctx.drawImage(img, 0, 0);\r\n    }\r\n    exports.loadExample = loadExample;\r\n});\r\n","/**\r\n * Module that manages the GUI when processing\r\n */\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./colorreductionmanagement\", \"./common\", \"./facetBorderSegmenter\", \"./facetBorderTracer\", \"./facetCreator\", \"./facetLabelPlacer\", \"./facetmanagement\", \"./facetReducer\", \"./gui\", \"./structs/point\"], function (require, exports, colorreductionmanagement_1, common_1, facetBorderSegmenter_1, facetBorderTracer_1, facetCreator_1, facetLabelPlacer_1, facetmanagement_1, facetReducer_1, gui_1, point_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.GUIProcessManager = exports.ProcessResult = void 0;\r\n    var ProcessResult = /** @class */ (function () {\r\n        function ProcessResult() {\r\n        }\r\n        return ProcessResult;\r\n    }());\r\n    exports.ProcessResult = ProcessResult;\r\n    /**\r\n     *  Manages the GUI states & processes the image step by step\r\n     */\r\n    var GUIProcessManager = /** @class */ (function () {\r\n        function GUIProcessManager() {\r\n        }\r\n        GUIProcessManager.process = function (settings, cancellationToken) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var c, ctx, imgData, width, height, newWidth, newHeight, newHeight, newWidth, tempCanvas, tabsOutput, kmeansImgData, facetResult, colormapResult, run, cBorderSegment, processResult;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            c = document.getElementById(\"canvas\");\r\n                            ctx = c.getContext(\"2d\");\r\n                            imgData = ctx.getImageData(0, 0, c.width, c.height);\r\n                            if (settings.resizeImageIfTooLarge && (c.width > settings.resizeImageWidth || c.height > settings.resizeImageHeight)) {\r\n                                width = c.width;\r\n                                height = c.height;\r\n                                if (width > settings.resizeImageWidth) {\r\n                                    newWidth = settings.resizeImageWidth;\r\n                                    newHeight = c.height / c.width * settings.resizeImageWidth;\r\n                                    width = newWidth;\r\n                                    height = newHeight;\r\n                                }\r\n                                if (height > settings.resizeImageHeight) {\r\n                                    newHeight = settings.resizeImageHeight;\r\n                                    newWidth = width / height * newHeight;\r\n                                    width = newWidth;\r\n                                    height = newHeight;\r\n                                }\r\n                                tempCanvas = document.createElement(\"canvas\");\r\n                                tempCanvas.width = width;\r\n                                tempCanvas.height = height;\r\n                                tempCanvas.getContext(\"2d\").drawImage(c, 0, 0, width, height);\r\n                                c.width = width;\r\n                                c.height = height;\r\n                                ctx.drawImage(tempCanvas, 0, 0, width, height);\r\n                                imgData = ctx.getImageData(0, 0, c.width, c.height);\r\n                            }\r\n                            // reset progress\r\n                            $(\".status .progress .determinate\").css(\"width\", \"0px\");\r\n                            $(\".status\").removeClass(\"complete\");\r\n                            tabsOutput = M.Tabs.getInstance(document.getElementById(\"tabsOutput\"));\r\n                            return [4 /*yield*/, GUIProcessManager.processKmeansClustering(imgData, tabsOutput, ctx, settings, cancellationToken)];\r\n                        case 1:\r\n                            kmeansImgData = _a.sent();\r\n                            facetResult = new facetmanagement_1.FacetResult();\r\n                            colormapResult = new colorreductionmanagement_1.ColorMapResult();\r\n                            // build color map\r\n                            colormapResult = colorreductionmanagement_1.ColorReducer.createColorMap(kmeansImgData);\r\n                            if (!(settings.narrowPixelStripCleanupRuns === 0)) return [3 /*break*/, 4];\r\n                            return [4 /*yield*/, GUIProcessManager.processFacetBuilding(colormapResult, cancellationToken)];\r\n                        case 2:\r\n                            // facet building\r\n                            facetResult = _a.sent();\r\n                            // facet reduction\r\n                            return [4 /*yield*/, GUIProcessManager.processFacetReduction(facetResult, tabsOutput, settings, colormapResult, cancellationToken)];\r\n                        case 3:\r\n                            // facet reduction\r\n                            _a.sent();\r\n                            return [3 /*break*/, 10];\r\n                        case 4:\r\n                            run = 0;\r\n                            _a.label = 5;\r\n                        case 5:\r\n                            if (!(run < settings.narrowPixelStripCleanupRuns)) return [3 /*break*/, 10];\r\n                            // clean up narrow pixel strips\r\n                            return [4 /*yield*/, colorreductionmanagement_1.ColorReducer.processNarrowPixelStripCleanup(colormapResult)];\r\n                        case 6:\r\n                            // clean up narrow pixel strips\r\n                            _a.sent();\r\n                            return [4 /*yield*/, GUIProcessManager.processFacetBuilding(colormapResult, cancellationToken)];\r\n                        case 7:\r\n                            // facet building\r\n                            facetResult = _a.sent();\r\n                            // facet reduction\r\n                            return [4 /*yield*/, GUIProcessManager.processFacetReduction(facetResult, tabsOutput, settings, colormapResult, cancellationToken)];\r\n                        case 8:\r\n                            // facet reduction\r\n                            _a.sent();\r\n                            _a.label = 9;\r\n                        case 9:\r\n                            run++;\r\n                            return [3 /*break*/, 5];\r\n                        case 10: \r\n                        // facet border tracing\r\n                        return [4 /*yield*/, GUIProcessManager.processFacetBorderTracing(tabsOutput, facetResult, cancellationToken)];\r\n                        case 11:\r\n                            // facet border tracing\r\n                            _a.sent();\r\n                            return [4 /*yield*/, GUIProcessManager.processFacetBorderSegmentation(facetResult, tabsOutput, settings, cancellationToken)];\r\n                        case 12:\r\n                            cBorderSegment = _a.sent();\r\n                            // facet label placement\r\n                            return [4 /*yield*/, GUIProcessManager.processFacetLabelPlacement(facetResult, cBorderSegment, tabsOutput, cancellationToken)];\r\n                        case 13:\r\n                            // facet label placement\r\n                            _a.sent();\r\n                            processResult = new ProcessResult();\r\n                            processResult.facetResult = facetResult;\r\n                            processResult.colorsByIndex = colormapResult.colorsByIndex;\r\n                            return [2 /*return*/, processResult];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        GUIProcessManager.processKmeansClustering = function (imgData, tabsOutput, ctx, settings, cancellationToken) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var cKmeans, ctxKmeans, kmeansImgData;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            (0, gui_1.time)(\"K-means clustering\");\r\n                            cKmeans = document.getElementById(\"cKMeans\");\r\n                            cKmeans.width = imgData.width;\r\n                            cKmeans.height = imgData.height;\r\n                            ctxKmeans = cKmeans.getContext(\"2d\");\r\n                            ctxKmeans.fillStyle = \"white\";\r\n                            ctxKmeans.fillRect(0, 0, cKmeans.width, cKmeans.height);\r\n                            kmeansImgData = ctxKmeans.getImageData(0, 0, cKmeans.width, cKmeans.height);\r\n                            tabsOutput.select(\"kmeans-pane\");\r\n                            $(\".status.kMeans\").addClass(\"active\");\r\n                            return [4 /*yield*/, colorreductionmanagement_1.ColorReducer.applyKMeansClustering(imgData, kmeansImgData, ctx, settings, function (kmeans) {\r\n                                    var progress = (100 - (kmeans.currentDeltaDistanceDifference > 100 ? 100 : kmeans.currentDeltaDistanceDifference)) / 100;\r\n                                    $(\"#statusKMeans\").css(\"width\", Math.round(progress * 100) + \"%\");\r\n                                    ctxKmeans.putImageData(kmeansImgData, 0, 0);\r\n                                    console.log(kmeans.currentDeltaDistanceDifference);\r\n                                    if (cancellationToken.isCancelled) {\r\n                                        throw new Error(\"Cancelled\");\r\n                                    }\r\n                                })];\r\n                        case 1:\r\n                            _a.sent();\r\n                            $(\".status\").removeClass(\"active\");\r\n                            $(\".status.kMeans\").addClass(\"complete\");\r\n                            (0, gui_1.timeEnd)(\"K-means clustering\");\r\n                            return [2 /*return*/, kmeansImgData];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        GUIProcessManager.processFacetBuilding = function (colormapResult, cancellationToken) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var facetResult;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            (0, gui_1.time)(\"Facet building\");\r\n                            $(\".status.facetBuilding\").addClass(\"active\");\r\n                            return [4 /*yield*/, facetCreator_1.FacetCreator.getFacets(colormapResult.width, colormapResult.height, colormapResult.imgColorIndices, function (progress) {\r\n                                    if (cancellationToken.isCancelled) {\r\n                                        throw new Error(\"Cancelled\");\r\n                                    }\r\n                                    $(\"#statusFacetBuilding\").css(\"width\", Math.round(progress * 100) + \"%\");\r\n                                })];\r\n                        case 1:\r\n                            facetResult = _a.sent();\r\n                            $(\".status\").removeClass(\"active\");\r\n                            $(\".status.facetBuilding\").addClass(\"complete\");\r\n                            (0, gui_1.timeEnd)(\"Facet building\");\r\n                            return [2 /*return*/, facetResult];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        GUIProcessManager.processFacetReduction = function (facetResult, tabsOutput, settings, colormapResult, cancellationToken) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var cReduction, ctxReduction, reductionImgData;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            (0, gui_1.time)(\"Facet reduction\");\r\n                            cReduction = document.getElementById(\"cReduction\");\r\n                            cReduction.width = facetResult.width;\r\n                            cReduction.height = facetResult.height;\r\n                            ctxReduction = cReduction.getContext(\"2d\");\r\n                            ctxReduction.fillStyle = \"white\";\r\n                            ctxReduction.fillRect(0, 0, cReduction.width, cReduction.height);\r\n                            reductionImgData = ctxReduction.getImageData(0, 0, cReduction.width, cReduction.height);\r\n                            tabsOutput.select(\"reduction-pane\");\r\n                            $(\".status.facetReduction\").addClass(\"active\");\r\n                            return [4 /*yield*/, facetReducer_1.FacetReducer.reduceFacets(settings.removeFacetsSmallerThanNrOfPoints, settings.removeFacetsFromLargeToSmall, settings.maximumNumberOfFacets, colormapResult.colorsByIndex, facetResult, colormapResult.imgColorIndices, function (progress) {\r\n                                    if (cancellationToken.isCancelled) {\r\n                                        throw new Error(\"Cancelled\");\r\n                                    }\r\n                                    // update status & image\r\n                                    $(\"#statusFacetReduction\").css(\"width\", Math.round(progress * 100) + \"%\");\r\n                                    var idx = 0;\r\n                                    for (var j = 0; j < facetResult.height; j++) {\r\n                                        for (var i = 0; i < facetResult.width; i++) {\r\n                                            var facet = facetResult.facets[facetResult.facetMap.get(i, j)];\r\n                                            var rgb = colormapResult.colorsByIndex[facet.color];\r\n                                            reductionImgData.data[idx++] = rgb[0];\r\n                                            reductionImgData.data[idx++] = rgb[1];\r\n                                            reductionImgData.data[idx++] = rgb[2];\r\n                                            idx++;\r\n                                        }\r\n                                    }\r\n                                    ctxReduction.putImageData(reductionImgData, 0, 0);\r\n                                })];\r\n                        case 1:\r\n                            _a.sent();\r\n                            $(\".status\").removeClass(\"active\");\r\n                            $(\".status.facetReduction\").addClass(\"complete\");\r\n                            (0, gui_1.timeEnd)(\"Facet reduction\");\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        GUIProcessManager.processFacetBorderTracing = function (tabsOutput, facetResult, cancellationToken) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var cBorderPath, ctxBorderPath;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            (0, gui_1.time)(\"Facet border tracing\");\r\n                            tabsOutput.select(\"borderpath-pane\");\r\n                            cBorderPath = document.getElementById(\"cBorderPath\");\r\n                            cBorderPath.width = facetResult.width;\r\n                            cBorderPath.height = facetResult.height;\r\n                            ctxBorderPath = cBorderPath.getContext(\"2d\");\r\n                            $(\".status.facetBorderPath\").addClass(\"active\");\r\n                            return [4 /*yield*/, facetBorderTracer_1.FacetBorderTracer.buildFacetBorderPaths(facetResult, function (progress) {\r\n                                    if (cancellationToken.isCancelled) {\r\n                                        throw new Error(\"Cancelled\");\r\n                                    }\r\n                                    // update status & image\r\n                                    $(\"#statusFacetBorderPath\").css(\"width\", Math.round(progress * 100) + \"%\");\r\n                                    ctxBorderPath.fillStyle = \"white\";\r\n                                    ctxBorderPath.fillRect(0, 0, cBorderPath.width, cBorderPath.height);\r\n                                    for (var _i = 0, _a = facetResult.facets; _i < _a.length; _i++) {\r\n                                        var f = _a[_i];\r\n                                        if (f != null && f.borderPath != null) {\r\n                                            ctxBorderPath.beginPath();\r\n                                            ctxBorderPath.moveTo(f.borderPath[0].getWallX(), f.borderPath[0].getWallY());\r\n                                            for (var i = 1; i < f.borderPath.length; i++) {\r\n                                                ctxBorderPath.lineTo(f.borderPath[i].getWallX(), f.borderPath[i].getWallY());\r\n                                            }\r\n                                            ctxBorderPath.stroke();\r\n                                        }\r\n                                    }\r\n                                })];\r\n                        case 1:\r\n                            _a.sent();\r\n                            $(\".status\").removeClass(\"active\");\r\n                            $(\".status.facetBorderPath\").addClass(\"complete\");\r\n                            (0, gui_1.timeEnd)(\"Facet border tracing\");\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        GUIProcessManager.processFacetBorderSegmentation = function (facetResult, tabsOutput, settings, cancellationToken) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var cBorderSegment, ctxBorderSegment;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            (0, gui_1.time)(\"Facet border segmentation\");\r\n                            cBorderSegment = document.getElementById(\"cBorderSegmentation\");\r\n                            cBorderSegment.width = facetResult.width;\r\n                            cBorderSegment.height = facetResult.height;\r\n                            ctxBorderSegment = cBorderSegment.getContext(\"2d\");\r\n                            tabsOutput.select(\"bordersegmentation-pane\");\r\n                            $(\".status.facetBorderSegmentation\").addClass(\"active\");\r\n                            return [4 /*yield*/, facetBorderSegmenter_1.FacetBorderSegmenter.buildFacetBorderSegments(facetResult, settings.nrOfTimesToHalveBorderSegments, function (progress) {\r\n                                    if (cancellationToken.isCancelled) {\r\n                                        throw new Error(\"Cancelled\");\r\n                                    }\r\n                                    // update status & image\r\n                                    $(\"#statusFacetBorderSegmentation\").css(\"width\", Math.round(progress * 100) + \"%\");\r\n                                    ctxBorderSegment.fillStyle = \"white\";\r\n                                    ctxBorderSegment.fillRect(0, 0, cBorderSegment.width, cBorderSegment.height);\r\n                                    for (var _i = 0, _a = facetResult.facets; _i < _a.length; _i++) {\r\n                                        var f = _a[_i];\r\n                                        if (f != null && progress > f.id / facetResult.facets.length) {\r\n                                            ctxBorderSegment.beginPath();\r\n                                            var path = f.getFullPathFromBorderSegments(false);\r\n                                            ctxBorderSegment.moveTo(path[0].x, path[0].y);\r\n                                            for (var i = 1; i < path.length; i++) {\r\n                                                ctxBorderSegment.lineTo(path[i].x, path[i].y);\r\n                                            }\r\n                                            ctxBorderSegment.stroke();\r\n                                        }\r\n                                    }\r\n                                })];\r\n                        case 1:\r\n                            _a.sent();\r\n                            $(\".status\").removeClass(\"active\");\r\n                            $(\".status.facetBorderSegmentation\").addClass(\"complete\");\r\n                            (0, gui_1.timeEnd)(\"Facet border segmentation\");\r\n                            return [2 /*return*/, cBorderSegment];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        GUIProcessManager.processFacetLabelPlacement = function (facetResult, cBorderSegment, tabsOutput, cancellationToken) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var cLabelPlacement, ctxLabelPlacement;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            (0, gui_1.time)(\"Facet label placement\");\r\n                            cLabelPlacement = document.getElementById(\"cLabelPlacement\");\r\n                            cLabelPlacement.width = facetResult.width;\r\n                            cLabelPlacement.height = facetResult.height;\r\n                            ctxLabelPlacement = cLabelPlacement.getContext(\"2d\");\r\n                            ctxLabelPlacement.fillStyle = \"white\";\r\n                            ctxLabelPlacement.fillRect(0, 0, cBorderSegment.width, cBorderSegment.height);\r\n                            ctxLabelPlacement.drawImage(cBorderSegment, 0, 0);\r\n                            tabsOutput.select(\"labelplacement-pane\");\r\n                            $(\".status.facetLabelPlacement\").addClass(\"active\");\r\n                            return [4 /*yield*/, facetLabelPlacer_1.FacetLabelPlacer.buildFacetLabelBounds(facetResult, function (progress) {\r\n                                    if (cancellationToken.isCancelled) {\r\n                                        throw new Error(\"Cancelled\");\r\n                                    }\r\n                                    // update status & image\r\n                                    $(\"#statusFacetLabelPlacement\").css(\"width\", Math.round(progress * 100) + \"%\");\r\n                                    for (var _i = 0, _a = facetResult.facets; _i < _a.length; _i++) {\r\n                                        var f = _a[_i];\r\n                                        if (f != null && f.labelBounds != null) {\r\n                                            ctxLabelPlacement.fillStyle = \"red\";\r\n                                            ctxLabelPlacement.fillRect(f.labelBounds.minX, f.labelBounds.minY, f.labelBounds.width, f.labelBounds.height);\r\n                                        }\r\n                                    }\r\n                                })];\r\n                        case 1:\r\n                            _a.sent();\r\n                            $(\".status\").removeClass(\"active\");\r\n                            $(\".status.facetLabelPlacement\").addClass(\"complete\");\r\n                            (0, gui_1.timeEnd)(\"Facet label placement\");\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        /**\r\n         *  Creates a vector based SVG image of the facets with the given configuration\r\n         */\r\n        GUIProcessManager.createSVG = function (facetResult, colorsByIndex, sizeMultiplier, fill, stroke, addColorLabels, fontSize, fontColor, onUpdate) {\r\n            if (fontSize === void 0) { fontSize = 50; }\r\n            if (fontColor === void 0) { fontColor = \"black\"; }\r\n            if (onUpdate === void 0) { onUpdate = null; }\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var xmlns, svg, count, _i, _a, f, newpath, useSegments, i, svgPath, data, i, midpointX, midpointY, txt, nrOfDigits, subsvg, g;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            xmlns = \"http://www.w3.org/2000/svg\";\r\n                            svg = document.createElementNS(xmlns, \"svg\");\r\n                            svg.setAttribute(\"width\", sizeMultiplier * facetResult.width + \"\");\r\n                            svg.setAttribute(\"height\", sizeMultiplier * facetResult.height + \"\");\r\n                            count = 0;\r\n                            _i = 0, _a = facetResult.facets;\r\n                            _b.label = 1;\r\n                        case 1:\r\n                            if (!(_i < _a.length)) return [3 /*break*/, 5];\r\n                            f = _a[_i];\r\n                            if (!(f != null && f.borderSegments.length > 0)) return [3 /*break*/, 3];\r\n                            newpath = [];\r\n                            useSegments = true;\r\n                            if (useSegments) {\r\n                                newpath = f.getFullPathFromBorderSegments(false);\r\n                                // shift from wall coordinates to pixel centers\r\n                                /*for (const p of newpath) {\r\n                                    p.x+=0.5;\r\n                                    p.y+=0.5;\r\n                                }*/\r\n                            }\r\n                            else {\r\n                                for (i = 0; i < f.borderPath.length; i++) {\r\n                                    newpath.push(new point_1.Point(f.borderPath[i].getWallX() + 0.5, f.borderPath[i].getWallY() + 0.5));\r\n                                }\r\n                            }\r\n                            if (newpath[0].x !== newpath[newpath.length - 1].x || newpath[0].y !== newpath[newpath.length - 1].y) {\r\n                                newpath.push(newpath[0]);\r\n                            } // close loop if necessary\r\n                            svgPath = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\r\n                            data = \"M \";\r\n                            data += newpath[0].x * sizeMultiplier + \" \" + newpath[0].y * sizeMultiplier + \" \";\r\n                            for (i = 1; i < newpath.length; i++) {\r\n                                midpointX = (newpath[i].x + newpath[i - 1].x) / 2;\r\n                                midpointY = (newpath[i].y + newpath[i - 1].y) / 2;\r\n                                data += \"Q \" + (midpointX * sizeMultiplier) + \" \" + (midpointY * sizeMultiplier) + \" \" + (newpath[i].x * sizeMultiplier) + \" \" + (newpath[i].y * sizeMultiplier) + \" \";\r\n                                // data += \"L \" + (newpath[i].x * sizeMultiplier) + \" \" + (newpath[i].y * sizeMultiplier) + \" \";\r\n                            }\r\n                            data += \"Z\";\r\n                            svgPath.setAttribute(\"data-facetId\", f.id + \"\");\r\n                            // Set path's data\r\n                            svgPath.setAttribute(\"d\", data);\r\n                            if (stroke) {\r\n                                svgPath.style.stroke = \"#000\";\r\n                            }\r\n                            else {\r\n                                // make the border the same color as the fill color if there is no border stroke\r\n                                // to not have gaps in between facets\r\n                                if (fill) {\r\n                                    svgPath.style.stroke = \"rgb(\".concat(colorsByIndex[f.color][0], \",\").concat(colorsByIndex[f.color][1], \",\").concat(colorsByIndex[f.color][2], \")\");\r\n                                }\r\n                            }\r\n                            svgPath.style.strokeWidth = \"1px\"; // Set stroke width\r\n                            if (fill) {\r\n                                svgPath.style.fill = \"rgb(\".concat(colorsByIndex[f.color][0], \",\").concat(colorsByIndex[f.color][1], \",\").concat(colorsByIndex[f.color][2], \")\");\r\n                            }\r\n                            else {\r\n                                svgPath.style.fill = \"none\";\r\n                            }\r\n                            svg.appendChild(svgPath);\r\n                            /*  for (const seg of f.borderSegments) {\r\n                                  const svgSegPath = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\r\n                                  let segData = \"M \";\r\n                                  const segPoints = seg.originalSegment.points;\r\n                                  segData += segPoints[0].x * sizeMultiplier + \" \" + segPoints[0].y * sizeMultiplier + \" \";\r\n                                  for (let i: number = 1; i < segPoints.length; i++) {\r\n                                      const midpointX = (segPoints[i].x + segPoints[i - 1].x) / 2;\r\n                                      const midpointY = (segPoints[i].y + segPoints[i - 1].y) / 2;\r\n                                      //data += \"Q \" + (midpointX * sizeMultiplier) + \" \" + (midpointY * sizeMultiplier) + \" \" + (newpath[i].x * sizeMultiplier) + \" \" + (newpath[i].y * sizeMultiplier) + \" \";\r\n                                      segData += \"L \" + (segPoints[i].x * sizeMultiplier) + \" \" + (segPoints[i].y * sizeMultiplier) + \" \";\r\n                                  }\r\n            \r\n                                  console.log(\"Facet \" + f.id + \", segment \" + segPoints[0].x + \",\" + segPoints[0].y + \" -> \" + segPoints[segPoints.length-1].x + \",\" +  segPoints[segPoints.length-1].y);\r\n            \r\n                                  svgSegPath.setAttribute(\"data-segmentFacet\", f.id + \"\");\r\n                                  // Set path's data\r\n                                  svgSegPath.setAttribute(\"d\", segData);\r\n                                  svgSegPath.style.stroke = \"#FF0\";\r\n                                  svgSegPath.style.fill = \"none\";\r\n                                  svg.appendChild(svgSegPath);\r\n                              }\r\n                              */\r\n                            // add the color labels if necessary. I mean, this is the whole idea behind the paint by numbers part\r\n                            // so I don't know why you would hide them\r\n                            if (addColorLabels) {\r\n                                txt = document.createElementNS(xmlns, \"text\");\r\n                                txt.setAttribute(\"font-family\", \"Tahoma\");\r\n                                nrOfDigits = (f.color + \"\").length;\r\n                                txt.setAttribute(\"font-size\", (fontSize / nrOfDigits) + \"\");\r\n                                txt.setAttribute(\"dominant-baseline\", \"middle\");\r\n                                txt.setAttribute(\"text-anchor\", \"middle\");\r\n                                txt.setAttribute(\"fill\", fontColor);\r\n                                txt.textContent = f.color + \"\";\r\n                                subsvg = document.createElementNS(xmlns, \"svg\");\r\n                                subsvg.setAttribute(\"width\", f.labelBounds.width * sizeMultiplier + \"\");\r\n                                subsvg.setAttribute(\"height\", f.labelBounds.height * sizeMultiplier + \"\");\r\n                                subsvg.setAttribute(\"overflow\", \"visible\");\r\n                                subsvg.setAttribute(\"viewBox\", \"-50 -50 100 100\");\r\n                                subsvg.setAttribute(\"preserveAspectRatio\", \"xMidYMid meet\");\r\n                                subsvg.appendChild(txt);\r\n                                g = document.createElementNS(xmlns, \"g\");\r\n                                g.setAttribute(\"class\", \"label\");\r\n                                g.setAttribute(\"transform\", \"translate(\" + f.labelBounds.minX * sizeMultiplier + \",\" + f.labelBounds.minY * sizeMultiplier + \")\");\r\n                                g.appendChild(subsvg);\r\n                                svg.appendChild(g);\r\n                            }\r\n                            if (!(count % 100 === 0)) return [3 /*break*/, 3];\r\n                            return [4 /*yield*/, (0, common_1.delay)(0)];\r\n                        case 2:\r\n                            _b.sent();\r\n                            if (onUpdate != null) {\r\n                                onUpdate(f.id / facetResult.facets.length);\r\n                            }\r\n                            _b.label = 3;\r\n                        case 3:\r\n                            count++;\r\n                            _b.label = 4;\r\n                        case 4:\r\n                            _i++;\r\n                            return [3 /*break*/, 1];\r\n                        case 5:\r\n                            if (onUpdate != null) {\r\n                                onUpdate(1);\r\n                            }\r\n                            return [2 /*return*/, svg];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        return GUIProcessManager;\r\n    }());\r\n    exports.GUIProcessManager = GUIProcessManager;\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.Clipboard = void 0;\r\n    // From https://stackoverflow.com/a/35576409/694640\r\n    /**\r\n     * image pasting into canvas\r\n     *\r\n     * @param {string} canvas_id - canvas id\r\n     * @param {boolean} autoresize - if canvas will be resized\r\n     */\r\n    var Clipboard = /** @class */ (function () {\r\n        function Clipboard(canvas_id, autoresize) {\r\n            this.ctrl_pressed = false;\r\n            this.command_pressed = false;\r\n            this.paste_event_support = false;\r\n            var _self = this;\r\n            this.canvas = document.getElementById(canvas_id);\r\n            this.ctx = this.canvas.getContext(\"2d\");\r\n            this.autoresize = autoresize;\r\n            // handlers\r\n            // document.addEventListener(\"keydown\", function (e) {\r\n            //     _self.on_keyboard_action(e);\r\n            // }, false); // firefox fix\r\n            // document.addEventListener(\"keyup\", function (e) {\r\n            //     _self.on_keyboardup_action(e);\r\n            // }, false); // firefox fix\r\n            document.addEventListener(\"paste\", function (e) {\r\n                _self.paste_auto(e);\r\n            }, false); // official paste handler\r\n            this.init();\r\n        }\r\n        // constructor - we ignore security checks here\r\n        Clipboard.prototype.init = function () {\r\n            this.pasteCatcher = document.createElement(\"div\");\r\n            this.pasteCatcher.setAttribute(\"id\", \"paste_ff\");\r\n            this.pasteCatcher.setAttribute(\"contenteditable\", \"\");\r\n            this.pasteCatcher.style.cssText = \"opacity:0;position:fixed;top:0px;left:0px;width:10px;margin-left:-20px;\";\r\n            document.body.appendChild(this.pasteCatcher);\r\n            var _self = this;\r\n            // create an observer instance\r\n            var observer = new MutationObserver(function (mutations) {\r\n                mutations.forEach(function (mutation) {\r\n                    if (_self.paste_event_support === true || _self.ctrl_pressed === false || mutation.type !== \"childList\") {\r\n                        // we already got data in paste_auto()\r\n                        return true;\r\n                    }\r\n                    // if paste handle failed - capture pasted object manually\r\n                    if (mutation.addedNodes.length === 1) {\r\n                        if (mutation.addedNodes[0].src !== undefined) {\r\n                            // image\r\n                            _self.paste_createImage(mutation.addedNodes[0].src);\r\n                        }\r\n                        // register cleanup after some time.\r\n                        setTimeout(function () {\r\n                            _self.pasteCatcher.innerHTML = \"\";\r\n                        }, 20);\r\n                    }\r\n                    return false;\r\n                });\r\n            });\r\n            var target = document.getElementById(\"paste_ff\");\r\n            var config = { attributes: true, childList: true, characterData: true };\r\n            observer.observe(target, config);\r\n        };\r\n        // default paste action\r\n        Clipboard.prototype.paste_auto = function (e) {\r\n            this.paste_event_support = false;\r\n            if (this.pasteCatcher !== undefined) {\r\n                this.pasteCatcher.innerHTML = \"\";\r\n            }\r\n            if (e.clipboardData) {\r\n                var items = e.clipboardData.items;\r\n                if (items) {\r\n                    this.paste_event_support = true;\r\n                    // access data directly\r\n                    for (var i = 0; i < items.length; i++) {\r\n                        if (items[i].type.indexOf(\"image\") !== -1) {\r\n                            // image\r\n                            var blob = items[i].getAsFile();\r\n                            var URLObj = window.URL || window.webkitURL;\r\n                            var source = URLObj.createObjectURL(blob);\r\n                            this.paste_createImage(source);\r\n                            e.preventDefault();\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    // wait for DOMSubtreeModified event\r\n                    // https://bugzilla.mozilla.org/show_bug.cgi?id=891247\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        // on keyboard press\r\n        Clipboard.prototype.on_keyboard_action = function (event) {\r\n            var k = event.keyCode;\r\n            // ctrl\r\n            if (k === 17 || event.metaKey || event.ctrlKey) {\r\n                if (this.ctrl_pressed === false) {\r\n                    this.ctrl_pressed = true;\r\n                }\r\n            }\r\n            // v\r\n            if (k === 86) {\r\n                if (document.activeElement !== undefined && document.activeElement.type === \"text\") {\r\n                    // let user paste into some input\r\n                    return false;\r\n                }\r\n                if (this.ctrl_pressed === true && this.pasteCatcher !== undefined) {\r\n                    this.pasteCatcher.focus();\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        // on keyboard release\r\n        Clipboard.prototype.on_keyboardup_action = function (event) {\r\n            // ctrl\r\n            if (event.ctrlKey === false && this.ctrl_pressed === true) {\r\n                this.ctrl_pressed = false;\r\n            }\r\n            else if (event.metaKey === false && this.command_pressed === true) {\r\n                this.command_pressed = false;\r\n                this.ctrl_pressed = false;\r\n            }\r\n        };\r\n        // draw pasted image to canvas\r\n        Clipboard.prototype.paste_createImage = function (source) {\r\n            var pastedImage = new Image();\r\n            var self = this;\r\n            pastedImage.onload = function () {\r\n                if (self.autoresize === true) {\r\n                    // resize\r\n                    self.canvas.width = pastedImage.width;\r\n                    self.canvas.height = pastedImage.height;\r\n                }\r\n                else {\r\n                    // clear canvas\r\n                    self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height);\r\n                }\r\n                self.ctx.drawImage(pastedImage, 0, 0);\r\n            };\r\n            pastedImage.src = source;\r\n        };\r\n        return Clipboard;\r\n    }());\r\n    exports.Clipboard = Clipboard;\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.KMeans = exports.Vector = void 0;\r\n    var Vector = /** @class */ (function () {\r\n        function Vector(values, weight) {\r\n            if (weight === void 0) { weight = 1; }\r\n            this.values = values;\r\n            this.weight = weight;\r\n        }\r\n        Vector.prototype.distanceTo = function (p) {\r\n            var sumSquares = 0;\r\n            for (var i = 0; i < this.values.length; i++) {\r\n                sumSquares += (p.values[i] - this.values[i]) * (p.values[i] - this.values[i]);\r\n            }\r\n            return Math.sqrt(sumSquares);\r\n        };\r\n        /**\r\n         *  Calculates the weighted average of the given points\r\n         */\r\n        Vector.average = function (pts) {\r\n            if (pts.length === 0) {\r\n                throw Error(\"Can't average 0 elements\");\r\n            }\r\n            var dims = pts[0].values.length;\r\n            var values = [];\r\n            for (var i = 0; i < dims; i++) {\r\n                values.push(0);\r\n            }\r\n            var weightSum = 0;\r\n            for (var _i = 0, pts_1 = pts; _i < pts_1.length; _i++) {\r\n                var p = pts_1[_i];\r\n                weightSum += p.weight;\r\n                for (var i = 0; i < dims; i++) {\r\n                    values[i] += p.weight * p.values[i];\r\n                }\r\n            }\r\n            for (var i = 0; i < values.length; i++) {\r\n                values[i] /= weightSum;\r\n            }\r\n            return new Vector(values);\r\n        };\r\n        return Vector;\r\n    }());\r\n    exports.Vector = Vector;\r\n    var KMeans = /** @class */ (function () {\r\n        function KMeans(points, k, random, centroids) {\r\n            if (centroids === void 0) { centroids = null; }\r\n            this.points = points;\r\n            this.k = k;\r\n            this.random = random;\r\n            this.currentIteration = 0;\r\n            this.pointsPerCategory = [];\r\n            this.centroids = [];\r\n            this.currentDeltaDistanceDifference = 0;\r\n            if (centroids != null) {\r\n                this.centroids = centroids;\r\n                for (var i = 0; i < this.k; i++) {\r\n                    this.pointsPerCategory.push([]);\r\n                }\r\n            }\r\n            else {\r\n                this.initCentroids();\r\n            }\r\n        }\r\n        KMeans.prototype.initCentroids = function () {\r\n            for (var i = 0; i < this.k; i++) {\r\n                this.centroids.push(this.points[Math.floor(this.points.length * this.random.next())]);\r\n                this.pointsPerCategory.push([]);\r\n            }\r\n        };\r\n        KMeans.prototype.step = function () {\r\n            // clear category\r\n            for (var i = 0; i < this.k; i++) {\r\n                this.pointsPerCategory[i] = [];\r\n            }\r\n            // calculate points per centroid\r\n            for (var _i = 0, _a = this.points; _i < _a.length; _i++) {\r\n                var p = _a[_i];\r\n                var minDist = Number.MAX_VALUE;\r\n                var centroidIndex = -1;\r\n                for (var k = 0; k < this.k; k++) {\r\n                    var dist = this.centroids[k].distanceTo(p);\r\n                    if (dist < minDist) {\r\n                        centroidIndex = k;\r\n                        minDist = dist;\r\n                    }\r\n                }\r\n                this.pointsPerCategory[centroidIndex].push(p);\r\n            }\r\n            var totalDistanceDiff = 0;\r\n            // adjust centroids\r\n            for (var k = 0; k < this.pointsPerCategory.length; k++) {\r\n                var cat = this.pointsPerCategory[k];\r\n                if (cat.length > 0) {\r\n                    var avg = Vector.average(cat);\r\n                    var dist = this.centroids[k].distanceTo(avg);\r\n                    totalDistanceDiff += dist;\r\n                    this.centroids[k] = avg;\r\n                }\r\n            }\r\n            this.currentDeltaDistanceDifference = totalDistanceDiff;\r\n            this.currentIteration++;\r\n        };\r\n        return KMeans;\r\n    }());\r\n    exports.KMeans = KMeans;\r\n});\r\n","// From https://stackoverflow.com/a/9493060/694640\r\ndefine([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.rgb2lab = exports.lab2rgb = exports.hslToRgb = exports.rgbToHsl = void 0;\r\n    /**\r\n      * Converts an RGB color value to HSL. Conversion formula\r\n      * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n      * Assumes r, g, and b are contained in the set [0, 255] and\r\n      * returns h, s, and l in the set [0, 1].\r\n      *\r\n      * @param   Number  r       The red color value\r\n      * @param   Number  g       The green color value\r\n      * @param   Number  b       The blue color value\r\n      * @return  Array           The HSL representation\r\n      */\r\n    function rgbToHsl(r, g, b) {\r\n        r /= 255, g /= 255, b /= 255;\r\n        var max = Math.max(r, g, b);\r\n        var min = Math.min(r, g, b);\r\n        var h, s, l = (max + min) / 2;\r\n        if (max === min) {\r\n            h = s = 0; // achromatic\r\n        }\r\n        else {\r\n            var d = max - min;\r\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n            switch (max) {\r\n                case r:\r\n                    h = (g - b) / d + (g < b ? 6 : 0);\r\n                    break;\r\n                case g:\r\n                    h = (b - r) / d + 2;\r\n                    break;\r\n                case b:\r\n                    h = (r - g) / d + 4;\r\n                    break;\r\n                default: h = 0;\r\n            }\r\n            h /= 6;\r\n        }\r\n        return [h, s, l];\r\n    }\r\n    exports.rgbToHsl = rgbToHsl;\r\n    /**\r\n     * Converts an HSL color value to RGB. Conversion formula\r\n     * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n     * Assumes h, s, and l are contained in the set [0, 1] and\r\n     * returns r, g, and b in the set [0, 255].\r\n     *\r\n     * @param   Number  h       The hue\r\n     * @param   Number  s       The saturation\r\n     * @param   Number  l       The lightness\r\n     * @return  Array           The RGB representation\r\n     */\r\n    function hslToRgb(h, s, l) {\r\n        var r, g, b;\r\n        if (s === 0) {\r\n            r = g = b = l; // achromatic\r\n        }\r\n        else {\r\n            var hue2rgb = function (p, q, t) {\r\n                if (t < 0) {\r\n                    t += 1;\r\n                }\r\n                if (t > 1) {\r\n                    t -= 1;\r\n                }\r\n                if (t < 1 / 6) {\r\n                    return p + (q - p) * 6 * t;\r\n                }\r\n                if (t < 1 / 2) {\r\n                    return q;\r\n                }\r\n                if (t < 2 / 3) {\r\n                    return p + (q - p) * (2 / 3 - t) * 6;\r\n                }\r\n                return p;\r\n            };\r\n            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n            var p = 2 * l - q;\r\n            r = hue2rgb(p, q, h + 1 / 3);\r\n            g = hue2rgb(p, q, h);\r\n            b = hue2rgb(p, q, h - 1 / 3);\r\n        }\r\n        return [r * 255, g * 255, b * 255];\r\n    }\r\n    exports.hslToRgb = hslToRgb;\r\n    // From https://github.com/antimatter15/rgb-lab/blob/master/color.js\r\n    function lab2rgb(lab) {\r\n        var y = (lab[0] + 16) / 116, x = lab[1] / 500 + y, z = y - lab[2] / 200, r, g, b;\r\n        x = 0.95047 * ((x * x * x > 0.008856) ? x * x * x : (x - 16 / 116) / 7.787);\r\n        y = 1.00000 * ((y * y * y > 0.008856) ? y * y * y : (y - 16 / 116) / 7.787);\r\n        z = 1.08883 * ((z * z * z > 0.008856) ? z * z * z : (z - 16 / 116) / 7.787);\r\n        r = x * 3.2406 + y * -1.5372 + z * -0.4986;\r\n        g = x * -0.9689 + y * 1.8758 + z * 0.0415;\r\n        b = x * 0.0557 + y * -0.2040 + z * 1.0570;\r\n        r = (r > 0.0031308) ? (1.055 * Math.pow(r, 1 / 2.4) - 0.055) : 12.92 * r;\r\n        g = (g > 0.0031308) ? (1.055 * Math.pow(g, 1 / 2.4) - 0.055) : 12.92 * g;\r\n        b = (b > 0.0031308) ? (1.055 * Math.pow(b, 1 / 2.4) - 0.055) : 12.92 * b;\r\n        return [Math.max(0, Math.min(1, r)) * 255,\r\n            Math.max(0, Math.min(1, g)) * 255,\r\n            Math.max(0, Math.min(1, b)) * 255];\r\n    }\r\n    exports.lab2rgb = lab2rgb;\r\n    function rgb2lab(rgb) {\r\n        var r = rgb[0] / 255, g = rgb[1] / 255, b = rgb[2] / 255, x, y, z;\r\n        r = (r > 0.04045) ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;\r\n        g = (g > 0.04045) ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;\r\n        b = (b > 0.04045) ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;\r\n        x = (r * 0.4124 + g * 0.3576 + b * 0.1805) / 0.95047;\r\n        y = (r * 0.2126 + g * 0.7152 + b * 0.0722) / 1.00000;\r\n        z = (r * 0.0193 + g * 0.1192 + b * 0.9505) / 1.08883;\r\n        x = (x > 0.008856) ? Math.pow(x, 1 / 3) : (7.787 * x) + 16 / 116;\r\n        y = (y > 0.008856) ? Math.pow(y, 1 / 3) : (7.787 * y) + 16 / 116;\r\n        z = (z > 0.008856) ? Math.pow(z, 1 / 3) : (7.787 * z) + 16 / 116;\r\n        return [(116 * y) - 16, 500 * (x - y), 200 * (y - z)];\r\n    }\r\n    exports.rgb2lab = rgb2lab;\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.PriorityQueue = exports.Map = void 0;\r\n    var Map = /** @class */ (function () {\r\n        function Map() {\r\n            this.obj = {};\r\n        }\r\n        Map.prototype.containsKey = function (key) {\r\n            return key in this.obj;\r\n        };\r\n        Map.prototype.getKeys = function () {\r\n            var keys = [];\r\n            for (var el in this.obj) {\r\n                if (this.obj.hasOwnProperty(el)) {\r\n                    keys.push(el);\r\n                }\r\n            }\r\n            return keys;\r\n        };\r\n        Map.prototype.get = function (key) {\r\n            var o = this.obj[key];\r\n            if (typeof o === \"undefined\") {\r\n                return null;\r\n            }\r\n            else {\r\n                return o;\r\n            }\r\n        };\r\n        Map.prototype.put = function (key, value) {\r\n            this.obj[key] = value;\r\n        };\r\n        Map.prototype.remove = function (key) {\r\n            delete this.obj[key];\r\n        };\r\n        Map.prototype.clone = function () {\r\n            var m = new Map();\r\n            m.obj = {};\r\n            for (var p in this.obj) {\r\n                m.obj[p] = this.obj[p];\r\n            }\r\n            return m;\r\n        };\r\n        return Map;\r\n    }());\r\n    exports.Map = Map;\r\n    var Heap = /** @class */ (function () {\r\n        function Heap() {\r\n            this.array = [];\r\n            this.keyMap = new Map();\r\n        }\r\n        Heap.prototype.add = function (obj) {\r\n            if (this.keyMap.containsKey(obj.getKey())) {\r\n                throw new Error(\"Item with key \" + obj.getKey() + \" already exists in the heap\");\r\n            }\r\n            this.array.push(obj);\r\n            this.keyMap.put(obj.getKey(), this.array.length - 1);\r\n            this.checkParentRequirement(this.array.length - 1);\r\n        };\r\n        Heap.prototype.replaceAt = function (idx, newobj) {\r\n            this.array[idx] = newobj;\r\n            this.keyMap.put(newobj.getKey(), idx);\r\n            this.checkParentRequirement(idx);\r\n            this.checkChildrenRequirement(idx);\r\n        };\r\n        Heap.prototype.shift = function () {\r\n            return this.removeAt(0);\r\n        };\r\n        Heap.prototype.remove = function (obj) {\r\n            var idx = this.keyMap.get(obj.getKey());\r\n            if (idx === -1) {\r\n                return;\r\n            }\r\n            this.removeAt(idx);\r\n        };\r\n        Heap.prototype.removeWhere = function (predicate) {\r\n            var itemsToRemove = [];\r\n            for (var i = this.array.length - 1; i >= 0; i--) {\r\n                if (predicate(this.array[i])) {\r\n                    itemsToRemove.push(this.array[i]);\r\n                }\r\n            }\r\n            for (var _i = 0, itemsToRemove_1 = itemsToRemove; _i < itemsToRemove_1.length; _i++) {\r\n                var el = itemsToRemove_1[_i];\r\n                this.remove(el);\r\n            }\r\n            for (var _a = 0, _b = this.array; _a < _b.length; _a++) {\r\n                var el = _b[_a];\r\n                if (predicate(el)) {\r\n                    console.log(\"Idx of element not removed: \" + this.keyMap.get(el.getKey()));\r\n                    throw new Error(\"element not removed: \" + el.getKey());\r\n                }\r\n            }\r\n        };\r\n        Heap.prototype.removeAt = function (idx) {\r\n            var obj = this.array[idx];\r\n            this.keyMap.remove(obj.getKey());\r\n            var isLastElement = idx === this.array.length - 1;\r\n            if (this.array.length > 0) {\r\n                var newobj = this.array.pop();\r\n                if (!isLastElement && this.array.length > 0) {\r\n                    this.replaceAt(idx, newobj);\r\n                }\r\n            }\r\n            return obj;\r\n        };\r\n        Heap.prototype.foreach = function (func) {\r\n            var arr = this.array.sort(function (e, e2) { return e.compareTo(e2); });\r\n            for (var _i = 0, arr_1 = arr; _i < arr_1.length; _i++) {\r\n                var el = arr_1[_i];\r\n                func(el);\r\n            }\r\n        };\r\n        Heap.prototype.peek = function () {\r\n            return this.array[0];\r\n        };\r\n        Heap.prototype.contains = function (key) {\r\n            return this.keyMap.containsKey(key);\r\n        };\r\n        Heap.prototype.at = function (key) {\r\n            var obj = this.keyMap.get(key);\r\n            if (typeof obj === \"undefined\") {\r\n                return null;\r\n            }\r\n            else {\r\n                return this.array[obj];\r\n            }\r\n        };\r\n        Heap.prototype.size = function () {\r\n            return this.array.length;\r\n        };\r\n        Heap.prototype.checkHeapRequirement = function (item) {\r\n            var idx = this.keyMap.get(item.getKey());\r\n            if (idx != null) {\r\n                this.checkParentRequirement(idx);\r\n                this.checkChildrenRequirement(idx);\r\n            }\r\n        };\r\n        Heap.prototype.checkChildrenRequirement = function (idx) {\r\n            var stop = false;\r\n            while (!stop) {\r\n                var left = this.getLeftChildIndex(idx);\r\n                var right = left === -1 ? -1 : left + 1;\r\n                if (left === -1) {\r\n                    return;\r\n                }\r\n                if (right >= this.size()) {\r\n                    right = -1;\r\n                }\r\n                var minIdx = void 0;\r\n                if (right === -1) {\r\n                    minIdx = left;\r\n                }\r\n                else {\r\n                    minIdx = (this.array[left].compareTo(this.array[right]) < 0) ? left : right;\r\n                }\r\n                if (this.array[idx].compareTo(this.array[minIdx]) > 0) {\r\n                    this.swap(idx, minIdx);\r\n                    idx = minIdx; // iteratively instead of recursion for this.checkChildrenRequirement(minIdx);\r\n                }\r\n                else {\r\n                    stop = true;\r\n                }\r\n            }\r\n        };\r\n        Heap.prototype.checkParentRequirement = function (idx) {\r\n            var curIdx = idx;\r\n            var parentIdx = Heap.getParentIndex(curIdx);\r\n            while (parentIdx >= 0 && this.array[parentIdx].compareTo(this.array[curIdx]) > 0) {\r\n                this.swap(curIdx, parentIdx);\r\n                curIdx = parentIdx;\r\n                parentIdx = Heap.getParentIndex(curIdx);\r\n            }\r\n        };\r\n        Heap.prototype.dump = function () {\r\n            if (this.size() === 0) {\r\n                return;\r\n            }\r\n            var idx = 0;\r\n            var leftIdx = this.getLeftChildIndex(idx);\r\n            var rightIdx = leftIdx + 1;\r\n            console.log(this.array);\r\n            console.log(\"--- keymap ---\");\r\n            console.log(this.keyMap);\r\n        };\r\n        Heap.prototype.swap = function (i, j) {\r\n            this.keyMap.put(this.array[i].getKey(), j);\r\n            this.keyMap.put(this.array[j].getKey(), i);\r\n            var tmp = this.array[i];\r\n            this.array[i] = this.array[j];\r\n            this.array[j] = tmp;\r\n        };\r\n        Heap.prototype.getLeftChildIndex = function (curIdx) {\r\n            var idx = ((curIdx + 1) * 2) - 1;\r\n            if (idx >= this.array.length) {\r\n                return -1;\r\n            }\r\n            else {\r\n                return idx;\r\n            }\r\n        };\r\n        Heap.getParentIndex = function (curIdx) {\r\n            if (curIdx === 0) {\r\n                return -1;\r\n            }\r\n            return Math.floor((curIdx + 1) / 2) - 1;\r\n        };\r\n        Heap.prototype.clone = function () {\r\n            var h = new Heap();\r\n            h.array = this.array.slice(0);\r\n            h.keyMap = this.keyMap.clone();\r\n            return h;\r\n        };\r\n        return Heap;\r\n    }());\r\n    var PriorityQueue = /** @class */ (function () {\r\n        function PriorityQueue() {\r\n            this.heap = new Heap();\r\n        }\r\n        PriorityQueue.prototype.enqueue = function (obj) {\r\n            this.heap.add(obj);\r\n        };\r\n        PriorityQueue.prototype.peek = function () {\r\n            return this.heap.peek();\r\n        };\r\n        PriorityQueue.prototype.updatePriority = function (key) {\r\n            this.heap.checkHeapRequirement(key);\r\n        };\r\n        PriorityQueue.prototype.get = function (key) {\r\n            return this.heap.at(key);\r\n        };\r\n        Object.defineProperty(PriorityQueue.prototype, \"size\", {\r\n            get: function () {\r\n                return this.heap.size();\r\n            },\r\n            enumerable: false,\r\n            configurable: true\r\n        });\r\n        PriorityQueue.prototype.dequeue = function () {\r\n            return this.heap.shift();\r\n        };\r\n        PriorityQueue.prototype.dump = function () {\r\n            this.heap.dump();\r\n        };\r\n        PriorityQueue.prototype.contains = function (key) {\r\n            return this.heap.contains(key);\r\n        };\r\n        PriorityQueue.prototype.removeWhere = function (predicate) {\r\n            this.heap.removeWhere(predicate);\r\n        };\r\n        PriorityQueue.prototype.foreach = function (func) {\r\n            this.heap.foreach(func);\r\n        };\r\n        PriorityQueue.prototype.clone = function () {\r\n            var p = new PriorityQueue();\r\n            p.heap = this.heap.clone();\r\n            return p;\r\n        };\r\n        return PriorityQueue;\r\n    }());\r\n    exports.PriorityQueue = PriorityQueue;\r\n});\r\n","// Faster flood fill from\r\n// http://www.adammil.net/blog/v126_A_More_Efficient_Flood_Fill.html\r\ndefine([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.fill = void 0;\r\n    function fill(x, y, width, height, visited, setFill) {\r\n        // at this point, we know array[y,x] is clear, and we want to move as far as possible to the upper-left. moving\r\n        // up is much more important than moving left, so we could try to make this smarter by sometimes moving to\r\n        // the right if doing so would allow us to move further up, but it doesn't seem worth the complexit\r\n        var xx = x;\r\n        var yy = y;\r\n        while (true) {\r\n            var ox = xx;\r\n            var oy = yy;\r\n            while (yy !== 0 && !visited(xx, yy - 1)) {\r\n                yy--;\r\n            }\r\n            while (xx !== 0 && !visited(xx - 1, yy)) {\r\n                xx--;\r\n            }\r\n            if (xx === ox && yy === oy) {\r\n                break;\r\n            }\r\n        }\r\n        fillCore(xx, yy, width, height, visited, setFill);\r\n    }\r\n    exports.fill = fill;\r\n    function fillCore(x, y, width, height, visited, setFill) {\r\n        // at this point, we know that array[y,x] is clear, and array[y-1,x] and array[y,x-1] are set.\r\n        // we'll begin scanning down and to the right, attempting to fill an entire rectangular block\r\n        var lastRowLength = 0; // the number of cells that were clear in the last row we scanned\r\n        do {\r\n            var rowLength = 0;\r\n            var sx = x; // keep track of how long this row is. sx is the starting x for the main scan below\r\n            // now we want to handle a case like |***|, where we fill 3 cells in the first row and then after we move to\r\n            // the second row we find the first  | **| cell is filled, ending our rectangular scan. rather than handling\r\n            // this via the recursion below, we'll increase the starting value of 'x' and reduce the last row length to\r\n            // match. then we'll continue trying to set the narrower rectangular block\r\n            if (lastRowLength !== 0 && visited(x, y)) {\r\n                do {\r\n                    if (--lastRowLength === 0) {\r\n                        return;\r\n                    } // shorten the row. if it's full, we're done\r\n                } while (visited(++x, y)); // otherwise, update the starting point of the main scan to match\r\n                sx = x;\r\n            }\r\n            else {\r\n                for (; x !== 0 && !visited(x - 1, y); rowLength++, lastRowLength++) {\r\n                    x--;\r\n                    setFill(x, y); // to avoid scanning the cells twice, we'll fill them and update rowLength here\r\n                    // if there's something above the new starting point, handle that recursively. this deals with cases\r\n                    // like |* **| when we begin filling from (2,0), move down to (2,1), and then move left to (0,1).\r\n                    // the  |****| main scan assumes the portion of the previous row from x to x+lastRowLength has already\r\n                    // been filled. adjusting x and lastRowLength breaks that assumption in this case, so we must fix it\r\n                    if (y !== 0 && !visited(x, y - 1)) {\r\n                        fill(x, y - 1, width, height, visited, setFill);\r\n                    } // use _Fill since there may be more up and left\r\n                }\r\n            }\r\n            // now at this point we can begin to scan the current row in the rectangular block. the span of the previous\r\n            // row from x (inclusive) to x+lastRowLength (exclusive) has already been filled, so we don't need to\r\n            // check it. so scan across to the right in the current row\r\n            for (; sx < width && !visited(sx, y); rowLength++, sx++) {\r\n                setFill(sx, y);\r\n            }\r\n            // now we've scanned this row. if the block is rectangular, then the previous row has already been scanned,\r\n            // so we don't need to look upwards and we're going to scan the next row in the next iteration so we don't\r\n            // need to look downwards. however, if the block is not rectangular, we may need to look upwards or rightwards\r\n            // for some portion of the row. if this row was shorter than the last row, we may need to look rightwards near\r\n            // the end, as in the case of |*****|, where the first row is 5 cells long and the second row is 3 cells long.\r\n            // we must look to the right  |*** *| of the single cell at the end of the second row, i.e. at (4,1)\r\n            if (rowLength < lastRowLength) {\r\n                for (var end = x + lastRowLength; ++sx < end;) { // there. any clear cells would have been connected to the previous\r\n                    if (!visited(sx, y)) {\r\n                        fillCore(sx, y, width, height, visited, setFill);\r\n                    } // row. the cells up and left must be set so use FillCore\r\n                }\r\n            }\r\n            else if (rowLength > lastRowLength && y !== 0) {\r\n                for (var ux = x + lastRowLength; ++ux < sx;) {\r\n                    if (!visited(ux, y - 1)) {\r\n                        fill(ux, y - 1, width, height, visited, setFill);\r\n                    } // since there may be clear cells up and left, use _Fill\r\n                }\r\n            }\r\n            lastRowLength = rowLength; // record the new row length\r\n        } while (lastRowLength !== 0 && ++y < height); // if we get to a full row or to the bottom, we're done\r\n    }\r\n});\r\n","define([\"require\", \"exports\", \"./datastructs\"], function (require, exports, datastructs_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.pointToPolygonDist = exports.polylabel = void 0;\r\n    function polylabel(polygon, precision) {\r\n        if (precision === void 0) { precision = 1.0; }\r\n        // find the bounding box of the outer ring\r\n        var minX = Number.MAX_VALUE;\r\n        var minY = Number.MAX_VALUE;\r\n        var maxX = Number.MIN_VALUE;\r\n        var maxY = Number.MIN_VALUE;\r\n        for (var i = 0; i < polygon[0].length; i++) {\r\n            var p = polygon[0][i];\r\n            if (p.x < minX) {\r\n                minX = p.x;\r\n            }\r\n            if (p.y < minY) {\r\n                minY = p.y;\r\n            }\r\n            if (p.x > maxX) {\r\n                maxX = p.x;\r\n            }\r\n            if (p.y > maxY) {\r\n                maxY = p.y;\r\n            }\r\n        }\r\n        var width = maxX - minX;\r\n        var height = maxY - minY;\r\n        var cellSize = Math.min(width, height);\r\n        var h = cellSize / 2;\r\n        // a priority queue of cells in order of their \"potential\" (max distance to polygon)\r\n        var cellQueue = new datastructs_1.PriorityQueue();\r\n        if (cellSize === 0) {\r\n            return { pt: { x: minX, y: minY }, distance: 0 };\r\n        }\r\n        // cover polygon with initial cells\r\n        for (var x = minX; x < maxX; x += cellSize) {\r\n            for (var y = minY; y < maxY; y += cellSize) {\r\n                cellQueue.enqueue(new Cell(x + h, y + h, h, polygon));\r\n            }\r\n        }\r\n        // take centroid as the first best guess\r\n        var bestCell = getCentroidCell(polygon);\r\n        // special case for rectangular polygons\r\n        var bboxCell = new Cell(minX + width / 2, minY + height / 2, 0, polygon);\r\n        if (bboxCell.d > bestCell.d) {\r\n            bestCell = bboxCell;\r\n        }\r\n        var numProbes = cellQueue.size;\r\n        while (cellQueue.size > 0) {\r\n            // pick the most promising cell from the queue\r\n            var cell = cellQueue.dequeue();\r\n            // update the best cell if we found a better one\r\n            if (cell.d > bestCell.d) {\r\n                bestCell = cell;\r\n            }\r\n            // do not drill down further if there's no chance of a better solution\r\n            if (cell.max - bestCell.d <= precision) {\r\n                continue;\r\n            }\r\n            // split the cell into four cells\r\n            h = cell.h / 2;\r\n            cellQueue.enqueue(new Cell(cell.x - h, cell.y - h, h, polygon));\r\n            cellQueue.enqueue(new Cell(cell.x + h, cell.y - h, h, polygon));\r\n            cellQueue.enqueue(new Cell(cell.x - h, cell.y + h, h, polygon));\r\n            cellQueue.enqueue(new Cell(cell.x + h, cell.y + h, h, polygon));\r\n            numProbes += 4;\r\n        }\r\n        return { pt: { x: bestCell.x, y: bestCell.y }, distance: bestCell.d };\r\n    }\r\n    exports.polylabel = polylabel;\r\n    var Cell = /** @class */ (function () {\r\n        function Cell(x, y, h, polygon) {\r\n            this.x = x;\r\n            this.y = y;\r\n            this.h = h;\r\n            this.d = pointToPolygonDist(x, y, polygon);\r\n            this.max = this.d + this.h * Math.SQRT2;\r\n        }\r\n        Cell.prototype.compareTo = function (other) {\r\n            return other.max - this.max;\r\n        };\r\n        Cell.prototype.getKey = function () {\r\n            return this.x + \",\" + this.y;\r\n        };\r\n        return Cell;\r\n    }());\r\n    // get squared distance from a point px,py to a segment [a-b]\r\n    function getSegDistSq(px, py, a, b) {\r\n        var x = a.x;\r\n        var y = a.y;\r\n        var dx = b.x - x;\r\n        var dy = b.y - y;\r\n        if (dx !== 0 || dy !== 0) {\r\n            var t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\r\n            if (t > 1) {\r\n                x = b.x;\r\n                y = b.y;\r\n            }\r\n            else if (t > 0) {\r\n                x += dx * t;\r\n                y += dy * t;\r\n            }\r\n        }\r\n        dx = px - x;\r\n        dy = py - y;\r\n        return dx * dx + dy * dy;\r\n    }\r\n    /**\r\n     * Signed distance from point to polygon outline (negative if point is outside)\r\n     */\r\n    function pointToPolygonDist(x, y, polygon) {\r\n        var inside = false;\r\n        var minDistSq = Infinity;\r\n        for (var k = 0; k < polygon.length; k++) {\r\n            var ring = polygon[k];\r\n            for (var i = 0, len = ring.length, j = len - 1; i < len; j = i++) {\r\n                var a = ring[i];\r\n                var b = ring[j];\r\n                if ((a.y > y !== b.y > y) &&\r\n                    (x < (b.x - a.x) * (y - a.y) / (b.y - a.y) + a.x)) {\r\n                    inside = !inside;\r\n                }\r\n                minDistSq = Math.min(minDistSq, getSegDistSq(x, y, a, b));\r\n            }\r\n        }\r\n        return (inside ? 1 : -1) * Math.sqrt(minDistSq);\r\n    }\r\n    exports.pointToPolygonDist = pointToPolygonDist;\r\n    // get polygon centroid\r\n    function getCentroidCell(polygon) {\r\n        var area = 0;\r\n        var x = 0;\r\n        var y = 0;\r\n        var points = polygon[0];\r\n        for (var i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n            var a = points[i];\r\n            var b = points[j];\r\n            var f = a.x * b.y - b.x * a.y;\r\n            x += (a.x + b.x) * f;\r\n            y += (a.y + b.y) * f;\r\n            area += f * 3;\r\n        }\r\n        if (area === 0) {\r\n            return new Cell(points[0].x, points[0].y, 0, polygon);\r\n        }\r\n        return new Cell(x / area, y / area, 0, polygon);\r\n    }\r\n});\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\ndefine([\"require\", \"exports\", \"./gui\", \"./lib/clipboard\"], function (require, exports, gui_1, clipboard_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    $(document).ready(function () {\r\n        var _this = this;\r\n        $(\".tabs\").tabs();\r\n        $(\".tooltipped\").tooltip();\r\n        var clip = new clipboard_1.Clipboard(\"canvas\", true);\r\n        $(\"#file\").change(function (ev) {\r\n            var files = $(\"#file\").get(0).files;\r\n            if (files !== null && files.length > 0) {\r\n                var reader_1 = new FileReader();\r\n                reader_1.onloadend = function () {\r\n                    var img = document.createElement(\"img\");\r\n                    img.onload = function () {\r\n                        var c = document.getElementById(\"canvas\");\r\n                        var ctx = c.getContext(\"2d\");\r\n                        c.width = img.naturalWidth;\r\n                        c.height = img.naturalHeight;\r\n                        ctx.drawImage(img, 0, 0);\r\n                    };\r\n                    img.onerror = function () {\r\n                        alert(\"Unable to load image\");\r\n                    };\r\n                    img.src = reader_1.result;\r\n                };\r\n                reader_1.readAsDataURL(files[0]);\r\n            }\r\n        });\r\n        (0, gui_1.loadExample)(\"imgSmall\");\r\n        $(\"#btnProcess\").click(function () {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var err_1;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            _a.trys.push([0, 2, , 3]);\r\n                            return [4 /*yield*/, (0, gui_1.process)()];\r\n                        case 1:\r\n                            _a.sent();\r\n                            return [3 /*break*/, 3];\r\n                        case 2:\r\n                            err_1 = _a.sent();\r\n                            alert(\"Error: \" + err_1);\r\n                            return [3 /*break*/, 3];\r\n                        case 3: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        $(\"#chkShowLabels, #chkFillFacets, #chkShowBorders, #txtSizeMultiplier, #txtLabelFontSize, #txtLabelFontColor\").change(function () { return __awaiter(_this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, (0, gui_1.updateOutput)()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); });\r\n        $(\"#btnDownloadSVG\").click(function () {\r\n            (0, gui_1.downloadSVG)();\r\n        });\r\n        $(\"#btnDownloadPNG\").click(function () {\r\n            (0, gui_1.downloadPNG)();\r\n        });\r\n        $(\"#btnDownloadPalettePNG\").click(function () {\r\n            (0, gui_1.downloadPalettePng)();\r\n        });\r\n        $(\"#lnkTrivial\").click(function () { (0, gui_1.loadExample)(\"imgTrivial\"); return false; });\r\n        $(\"#lnkSmall\").click(function () { (0, gui_1.loadExample)(\"imgSmall\"); return false; });\r\n        $(\"#lnkMedium\").click(function () { (0, gui_1.loadExample)(\"imgMedium\"); return false; });\r\n    });\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.Random = void 0;\r\n    var Random = /** @class */ (function () {\r\n        function Random(seed) {\r\n            if (typeof seed === \"undefined\") {\r\n                this.seed = new Date().getTime();\r\n            }\r\n            else {\r\n                this.seed = seed;\r\n            }\r\n        }\r\n        Random.prototype.next = function () {\r\n            var x = Math.sin(this.seed++) * 10000;\r\n            return x - Math.floor(x);\r\n        };\r\n        return Random;\r\n    }());\r\n    exports.Random = Random;\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.Settings = exports.ClusteringColorSpace = void 0;\r\n    var ClusteringColorSpace;\r\n    (function (ClusteringColorSpace) {\r\n        ClusteringColorSpace[ClusteringColorSpace[\"RGB\"] = 0] = \"RGB\";\r\n        ClusteringColorSpace[ClusteringColorSpace[\"HSL\"] = 1] = \"HSL\";\r\n        ClusteringColorSpace[ClusteringColorSpace[\"LAB\"] = 2] = \"LAB\";\r\n    })(ClusteringColorSpace = exports.ClusteringColorSpace || (exports.ClusteringColorSpace = {}));\r\n    var Settings = /** @class */ (function () {\r\n        function Settings() {\r\n            this.kMeansNrOfClusters = 16;\r\n            this.kMeansMinDeltaDifference = 1;\r\n            this.kMeansClusteringColorSpace = ClusteringColorSpace.RGB;\r\n            this.kMeansColorRestrictions = [];\r\n            this.colorAliases = {};\r\n            this.narrowPixelStripCleanupRuns = 3; // 3 seems like a good compromise between removing enough narrow pixel strips to convergence. This fixes e.g. https://i.imgur.com/dz4ANz1.png\r\n            this.removeFacetsSmallerThanNrOfPoints = 20;\r\n            this.removeFacetsFromLargeToSmall = true;\r\n            this.maximumNumberOfFacets = Number.MAX_VALUE;\r\n            this.nrOfTimesToHalveBorderSegments = 2;\r\n            this.resizeImageIfTooLarge = true;\r\n            this.resizeImageWidth = 1024;\r\n            this.resizeImageHeight = 1024;\r\n            this.randomSeed = new Date().getTime();\r\n        }\r\n        return Settings;\r\n    }());\r\n    exports.Settings = Settings;\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.BoundingBox = void 0;\r\n    var BoundingBox = /** @class */ (function () {\r\n        function BoundingBox() {\r\n            this.minX = Number.MAX_VALUE;\r\n            this.minY = Number.MAX_VALUE;\r\n            this.maxX = Number.MIN_VALUE;\r\n            this.maxY = Number.MIN_VALUE;\r\n        }\r\n        Object.defineProperty(BoundingBox.prototype, \"width\", {\r\n            get: function () {\r\n                return this.maxX - this.minX + 1;\r\n            },\r\n            enumerable: false,\r\n            configurable: true\r\n        });\r\n        Object.defineProperty(BoundingBox.prototype, \"height\", {\r\n            get: function () {\r\n                return this.maxY - this.minY + 1;\r\n            },\r\n            enumerable: false,\r\n            configurable: true\r\n        });\r\n        return BoundingBox;\r\n    }());\r\n    exports.BoundingBox = BoundingBox;\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.Point = void 0;\r\n    var Point = /** @class */ (function () {\r\n        function Point(x, y) {\r\n            this.x = x;\r\n            this.y = y;\r\n        }\r\n        Point.prototype.distanceTo = function (pt) {\r\n            // don't do euclidean because then neighbours should be diagonally as well\r\n            // because sqrt(2) < 2\r\n            //  return Math.sqrt((pt.x - this.x) * (pt.x - this.x) + (pt.y - this.y) * (pt.y - this.y));\r\n            return Math.abs(pt.x - this.x) + Math.abs(pt.y - this.y);\r\n        };\r\n        Point.prototype.distanceToCoord = function (x, y) {\r\n            // don't do euclidean because then neighbours should be diagonally as well\r\n            // because sqrt(2) < 2\r\n            //  return Math.sqrt((pt.x - this.x) * (pt.x - this.x) + (pt.y - this.y) * (pt.y - this.y));\r\n            return Math.abs(x - this.x) + Math.abs(y - this.y);\r\n        };\r\n        return Point;\r\n    }());\r\n    exports.Point = Point;\r\n});\r\n","define([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.BooleanArray2D = exports.Uint8Array2D = exports.Uint32Array2D = void 0;\r\n    var Uint32Array2D = /** @class */ (function () {\r\n        function Uint32Array2D(width, height) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.arr = new Uint32Array(width * height);\r\n        }\r\n        Uint32Array2D.prototype.get = function (x, y) {\r\n            return this.arr[y * this.width + x];\r\n        };\r\n        Uint32Array2D.prototype.set = function (x, y, value) {\r\n            this.arr[y * this.width + x] = value;\r\n        };\r\n        return Uint32Array2D;\r\n    }());\r\n    exports.Uint32Array2D = Uint32Array2D;\r\n    var Uint8Array2D = /** @class */ (function () {\r\n        function Uint8Array2D(width, height) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.arr = new Uint8Array(width * height);\r\n        }\r\n        Uint8Array2D.prototype.get = function (x, y) {\r\n            return this.arr[y * this.width + x];\r\n        };\r\n        Uint8Array2D.prototype.set = function (x, y, value) {\r\n            this.arr[y * this.width + x] = value;\r\n        };\r\n        Uint8Array2D.prototype.matchAllAround = function (x, y, value) {\r\n            var idx = y * this.width + x;\r\n            return (x - 1 >= 0 && this.arr[idx - 1] === value) &&\r\n                (y - 1 >= 0 && this.arr[idx - this.width] === value) &&\r\n                (x + 1 < this.width && this.arr[idx + 1] === value) &&\r\n                (y + 1 < this.height && this.arr[idx + this.width] === value);\r\n        };\r\n        return Uint8Array2D;\r\n    }());\r\n    exports.Uint8Array2D = Uint8Array2D;\r\n    var BooleanArray2D = /** @class */ (function () {\r\n        function BooleanArray2D(width, height) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.arr = new Uint8Array(width * height);\r\n        }\r\n        BooleanArray2D.prototype.get = function (x, y) {\r\n            return this.arr[y * this.width + x] !== 0;\r\n        };\r\n        BooleanArray2D.prototype.set = function (x, y, value) {\r\n            this.arr[y * this.width + x] = value ? 1 : 0;\r\n        };\r\n        return BooleanArray2D;\r\n    }());\r\n    exports.BooleanArray2D = BooleanArray2D;\r\n});\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(519);\n"],"names":["P","Promise","resolve","reject","fulfilled","value","step","generator","next","e","rejected","result","done","then","apply","thisArg","_arguments","__generator","this","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","require","exports","common_1","clustering_1","colorconversion_1","settings_1","typedarrays_1","random_1","Object","defineProperty","ColorReducer","ColorMapResult","createColorMap","kmeansImgData","imgColorIndices","Uint8Array2D","width","height","colorIndex","colors","colorsByIndex","idx","j","i","r","data","b","currentColorIndex","color","set","applyKMeansClustering","imgData","outputImgData","ctx","settings","onUpdate","__awaiter","vectors","vIdx","pointsByColor","_i","_a","rgb","weight","vec","random","kmeans","curTime","_b","concat","keys","split","map","parseInt","kMeansClusteringColorSpace","ClusteringColorSpace","RGB","HSL","rgbToHsl","LAB","rgb2lab","Vector","tag","Random","randomSeed","Date","getTime","KMeans","kMeansNrOfClusters","currentDeltaDistanceDifference","kMeansMinDeltaDifference","delay","updateKmeansOutputImageData","restrictToSpecifiedColors","c","centroids","centroid","pointsPerCategory","values","hsl","hslToRgb","lab","lab2rgb","Math","floor","kMeansColorRestrictions","minDistance","Number","MAX_VALUE","closestRestrictedColor","_c","restrictionLab","centroidLab","colorAliases","distance","sqrt","pointRGB","_d","_e","pt","ptx","dataOffset","buildColorDistanceMatrix","colorDistances","Array","c1","c2","processNarrowPixelStripCleanup","colormapResult","count","top_1","bottom","left","right","cur","topColorDistance","bottomColorDistance","leftColorDistance","rightColorDistance","get","console","log","CancellationToken","ms","window","exec","setTimeout","isCancelled","point_1","facetmanagement_1","FacetBorderSegmenter","FacetBoundarySegment","PathSegment","points","neighbour","originalSegment","reverseOrder","buildFacetBorderSegments","facetResult","nrOfTimesToHalvePoints","segmentsPerFacet","prepareSegmentsPerFacet","reduceSegmentComplexity","matchSegmentsWithNeighbours","facets","segments","borderPath","currentPoints","prevBorderPoint","curBorderPoint","isTransitionPoint","oldNeighbour","getNeighbour","x","orientation","OrientationEnum","Top","Left","facetMap","Right","Bottom","segment","mergedPoints","id","reduceSegmentHaarWavelet","newpath","skipOutsideBorders","reducedPath","isOutsideBorderPoint","cx","cy","PathPoint","Point","point","calculateArea","path","total","abs","MAX_DISTANCE","s","neighbourFacet","neighbourSegments","ns","neighbourSegment","segStartPoint","segEndPoint","nSegStartPoint","nSegEndPoint","matchesStraight","matchesReverse","borderSegments","distanceTo","FacetBorderTracer","buildFacetBorderPaths","borderMask","facetProcessingOrder","fidx","bp","xWall","yWall","borderStartIndex","BooleanArray2D","filter","slice","sort","a","pointCount","borderPoints","bbox","minX","maxX","minY","maxY","getPath","finished","addPointToPath","possibleNextPoints","nextpt","path_1","pathPoint","fill_1","boundingbox_1","FacetCreator","getFacets","visited","facetIndex","facet","FacetResult","Uint32Array2D","buildFacet","buildFacetNeighbour","facetColorIndex","Facet","BoundingBox","neighbourFacetsIsDirty","neighbourFacets","fill","pty","matchAllAround","uniqueFacets","leftFacetId","topFacetId","rightFacetId","bottomFacetId","k","hasOwnProperty","polylabel_1","facetCreator_1","FacetLabelPlacer","buildFacetLabelBounds","polyRings","onlyOuterRing","neighbourIdx","neighbourPath","innerPadding","getFullPathFromBorderSegments","doesNeighbourFallInsideInCurrentFacet","polylabel","labelBounds","fallsInside","pointToPolygonDist","colorreductionmanagement_1","FacetReducer","reduceFacets","smallerThan","removeFacetsFromLargeToSmall","maximumNumberOfFacets","visitedCache","facetCount","startFacetCount","facetProcessingOrder_1","facetToRemove","reverse","deleteFacet","facetIdToRemove","visitedArrayCache","closestNeighbour","getClosestNeighbourForPixel","warn","rebuildForFacetChange","rebuildChangedNeighbourFacets","needsToRebuild","error","minColorDistance","distanceToCoord","colorDistance","changedNeighboursSet","newFacet","_f","_g","extendStatics","d","setPrototypeOf","__proto__","p","prototype","String","__","constructor","create","_super","_this","__extends","getWallX","getWallY","toString","useWalls","addPoint","lastSegment","seg","guiprocessmanager_1","loadExample","downloadSVG","downloadPNG","downloadPalettePng","updateOutput","process","parseSettings","timeEnd","time","processResult","cancellationToken","timers","str","$","append","Settings","prop","val","parseFloat","removeFacetsSmallerThanNrOfPoints","nrOfTimesToHalveBorderSegments","narrowPixelStripCleanupRuns","resizeImageIfTooLarge","resizeImageWidth","resizeImageHeight","restrictedColorLines_1","tline","trim","indexOf","rgbparts","red","green","blue","isNaN","showLabels","stroke","sizeMultiplier","fontSize","fontColor","svg","css","removeClass","addClass","GUIProcessManager","createSVG","progress","Error","round","empty","html","style","createPaletteHtml","tooltip","name","M","Tabs","getInstance","document","getElementById","select","canvas","createElement","nrRows","ceil","margin","getContext","translate","fillStyle","fillRect","cellHeight","strokeStyle","strokeRect","nrText","font","nrTextSize","measureText","lineWidth","strokeText","cellWidth","fillText","rgbText","rgbTextSize","dataURL","toDataURL","dl","appendChild","setAttribute","click","saveSvgAsPng","svgEl","svgData","outerHTML","svgBlob","Blob","type","svgUrl","URL","createObjectURL","downloadLink","href","download","removeChild","imgId","img","naturalWidth","naturalHeight","drawImage","facetBorderSegmenter_1","facetBorderTracer_1","facetLabelPlacer_1","facetReducer_1","gui_1","ProcessResult","newHeight","newWidth","tempCanvas","tabsOutput","run","cBorderSegment","getImageData","processKmeansClustering","processFacetBuilding","processFacetReduction","processFacetBorderTracing","processFacetBorderSegmentation","processFacetLabelPlacement","cKmeans","ctxKmeans","putImageData","cReduction","ctxReduction","reductionImgData","cBorderPath","ctxBorderPath","beginPath","moveTo","lineTo","ctxBorderSegment","cLabelPlacement","ctxLabelPlacement","addColorLabels","xmlns","svgPath","midpointX","midpointY","txt","nrOfDigits","subsvg","createElementNS","strokeWidth","textContent","Clipboard","canvas_id","autoresize","ctrl_pressed","command_pressed","paste_event_support","_self","addEventListener","paste_auto","init","pasteCatcher","cssText","observer","MutationObserver","mutations","forEach","mutation","addedNodes","undefined","src","paste_createImage","innerHTML","target","observe","attributes","childList","characterData","clipboardData","items","blob","getAsFile","source","webkitURL","preventDefault","on_keyboard_action","event","keyCode","metaKey","ctrlKey","activeElement","focus","on_keyboardup_action","pastedImage","Image","self","onload","clearRect","sumSquares","average","pts","dims","weightSum","pts_1","currentIteration","initCentroids","minDist","centroidIndex","dist","totalDistanceDiff","cat","avg","h","max","min","l","hue2rgb","q","z","pow","PriorityQueue","Map","obj","containsKey","key","getKeys","el","o","put","remove","clone","m","Heap","array","keyMap","add","getKey","checkParentRequirement","replaceAt","newobj","checkChildrenRequirement","shift","removeAt","removeWhere","predicate","itemsToRemove","itemsToRemove_1","isLastElement","foreach","func","arr_1","e2","compareTo","peek","contains","at","size","checkHeapRequirement","item","stop","getLeftChildIndex","minIdx","swap","curIdx","parentIdx","getParentIndex","dump","tmp","heap","enqueue","updatePriority","enumerable","configurable","dequeue","setFill","xx","yy","ox","oy","fillCore","lastRowLength","rowLength","sx","end","ux","datastructs_1","polygon","precision","MIN_VALUE","cellSize","cellQueue","Cell","bestCell","area","len","getCentroidCell","bboxCell","cell","SQRT2","other","getSegDistSq","px","py","dx","dy","inside","minDistSq","Infinity","ring","clipboard_1","ready","tabs","change","ev","files","reader_1","FileReader","onloadend","onerror","alert","readAsDataURL","err_1","seed","sin","arr","Uint32Array","Uint8Array","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__"],"sourceRoot":""}